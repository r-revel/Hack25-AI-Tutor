{
  "title": "Развертывание сайта с использованием LEMP",
  "chapters": [
    {
      "name": "Развертывание сайта с использованием LEMP",
      "content": "Практические руководства Evolution    \n\n # Развертывание сайта с использованием LEMP   Эта статья полезна?          \nС помощью этого руководства вы создадите простой сайт с использованием стека LEMP.\nВы будете использовать следующие сервисы:\n- Виртуальные машины — сервис, в рамках которого предоставляется виртуальная машина, на которой будет развернут веб-сервер Nginx и СУБД MySQL.\n- Публичный IP-адрес для доступа к сервису через интернет.\n- Бесплатный сервис nip.io для получения публичного доменного имени и сертификата.\nВы также можете использовать собственное зарегистрированное доменное имя и SSL-сертификат для организации доступа.\n- Nginx — веб-сервер для проксирования запросов и организации защищeнного HTTPS-доступа к приложению.\n- Let’s Encrypt — сервис для автоматического получения бесплатного SSL-сертификата.\nШаги:\n1. Разверните ресурсы в облаке.\n2. Настройте Nginx.\n3. Настройте базу данных MySQL.\n4. Настройте сайт.\n5. Настройте доменное имя.\n\n## Перед началом работы\n1. Зарегистрируйтесь в личном кабинете Cloud.ru.\nЕсли вы уже зарегистрированы, войдите под своей учетной записью.\n2. Убедитесь, что вам назначена сервисная роль eiv.admin или роль администратора проекта.\nПри необходимости настройте права или запросите их у администратора.\n\n## 1. Разверните ресурсы в облаке\nНа этом шаге вы подготовите группу безопасности и виртуальную машину.\n1. Создайте группу безопасности с названием sg-lemp в зоне доступности ru.AZ-1 и добавьте в нее правила:\n Трафик Протокол Порт Тип источника/адресата Источник/Адресат ВходящийTCP443IP-адрес0.0.0.0/0Исходящий Любой Оставьте пустымIP-адрес0.0.0.0/0\n2. Создайте виртуальную машину со следующими параметрами:\n- Название — lemp-server.\n- Зона доступности — ru.AZ-1.\n- Образ — на вкладке Маркетплейс выберите образ LEMP.\n- Сетевой интерфейс — выберите тип Подсеть с публичным IP.\n- Публичный IP — оставьте Арендовать новый или выберите IP-адрес из списка арендованных.\n- Группы безопасности — добавьте sg-lemp.\n- Имя пользователя — cloud-user.\n- Метод аутентификации — Пароль\n- Пароль — задайте пароль пользователя.\n3. В строке созданной ВМ скопируйте и сохраните адрес из столбца Публичный IP: он потребуется для дальнейшей настройки.\n\n## 2. Настройте Nginx\nСервер Nginx обрабатывает запросы пользователей к сайту.\n1. Выберите виртуальную машину lemp-server в списке.\n2. Перейдите на вкладку Серийная консоль.\n3. Введите логин и пароль, указанные при создании виртуальной машины.\n4. Обновите пакеты ОС.\nВ серийной консоли выполните команды:\n```\nsudo apt updatesudo apt upgrade\n```\n5. Для обработки скриптов установите менеджер процессов PHP-FPM:\n```\nsudo apt install php8.1-fpm\n```\n6. Создайте новый конфигурационный файл:\n```\nsudo nano /etc/nginx/sites-available/mysite\n```\n7. Добавьте в файл конфигурацию виртуального сервера, заменив <public_ip> на публичный IP-адрес виртуальной машины lemp-server:\n```\n server {    listen 80;    server_name <public_ip>.nip.io;\n    root /var/www/html/mysite;    index index.php index.html index.htm;\n    location / {        try_files $uri $uri/ =404;    }\n    location ~ \\.php$ {        include snippets/fastcgi-php.conf;        fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;    }\n    location ~ /\\.ht {        deny all;    }}\n```\n8. Добавьте ссылку на конфигурационный файл в каталоге sites-enabled:\n```\nsudo ln -s /etc/nginx/sites-available/mysite /etc/nginx/sites-enabled/\n```\n9. Проверьте, что в конфигурации Nginx нет ошибок:\n```\nsudo nginx -t\n```\n10. Чтобы применить настройки, перезапустите Nginx:\n```\nsudo systemctl restart nginx\n```\n\n## 3. Настройте базу данных MySQL\nВ базе данных будут храниться записи, которые добавляются через форму на сайте.\n1. Подключитесь к MySQL:\n```\nsudo mysql -u root -p\n```\n2. Создайте новую базу данных.\nВыполните построчно следующие команды:\n```\nCREATE DATABASE mydatabase;USE mydatabase;CREATE TABLE entries (    id INT AUTO_INCREMENT PRIMARY KEY,    content TEXT NOT NULL);\n```\n3. Создайте пользователя db_user:\n```\nCREATE USER 'db_user'@'localhost' IDENTIFIED BY '<user_password>';GRANT ALL PRIVILEGES ON mydatabase.* TO 'db_user'@'localhost';FLUSH PRIVILEGES;EXIT;\n```\n\nГде <user_password> — пароль пользователя.\n\n## 4. Настройте сайт\nСайт состоит из одной страницы с простой формой для добавления записей.\n1. Создайте корневой каталог сайта:\n```\nsudo mkdir -p /var/www/html/mysite\n```\n2. Установите права доступа:\n```\nsudo chown -R $USER:$USER /var/www/html/mysitesudo chmod -R 755 /var/www/html/mysite\n```\n3. Создайте стартовую страницу сайта:\n```\nsudo nano /var/www/html/mysite/index.php\n```\n4. Вставьте на страницу код, заменив <user_password> на пароль пользователя базы данных, созданного на предыдущем шаге:\n```\n<?php$conn = new mysqli(\"localhost\", \"db_user\", \"<user_password>\", \"mydatabase\");\nif ($conn->connect_error) {    die(\"Connection failed: \" . $conn->connect_error);}\nif ($_SERVER[\"REQUEST_METHOD\"] == \"POST\") {    $content = $_POST[\"content\"];    $stmt = $conn->prepare(\"INSERT INTO entries (content) VALUES (?)\");    $stmt->bind_param(\"s\", $content);    $stmt->execute();    $stmt->close();}\n$result = $conn->query(\"SELECT * FROM entries\");?>\n<!DOCTYPE html><html><head>    <title>Simple LEMP Site</title></head><body>    <h1>Add a New Record</h1>    <form method=\"post\">        <textarea name=\"content\" rows=\"4\" cols=\"50\"></textarea><br>        <input type=\"submit\" value=\"Submit\">    </form>\n    <h2>Entries</h2>    <ul>    <?php while ($row = $result->fetch_assoc()): ?>        <li><?php echo htmlspecialchars($row['content']); ?></li>    <?php endwhile; ?>    </ul></body></html>\n<?php$conn->close();?>\n```\n\n## 5. Настройте доменное имя\nДля создания доменного имени и SSL-сертификата используется сервис nip.io.\nТакже вы можете использовать собственный домен и SSL-сертификат.\n1. Подготовьте доменное имя вида <public_ip>.nip.io, где <public_ip> — публичный IP-адрес виртуальной машины lemp-server.\n2. Установите утилиту для формирования SSL-сертификата и запустите ее:\n```\nsudo apt install certbot python3-certbot-nginxsudo certbot --nginx -d <public_ip>.nip.io --register-unsafely-without-email\n```\n3. Откройте браузер и перейдите по адресу <public_ip>.nip.io.\nПри переходе по адресу вашего сайта откроется форма для добавления записей.\nДобавленные записи отображаются в списке под формой.\n\n## Результат\nВы развернули сайт с использованием стека LEMP и обеспечили безопасный доступ к нему через Nginx.\n\n  [© 2025 Cloud.ru](https://cloud.ru)",
      "debug": {
        "start_page": 1,
        "end_page": 1
      }
    }
  ]
}