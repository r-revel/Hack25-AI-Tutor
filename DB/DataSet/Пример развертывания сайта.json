{
  "title": "Пример развертывания сайта",
  "chapters": [
    {
      "name": "Пример развертывания сайта",
      "content": "Практические руководства Evolution    \n\n # Пример развертывания сайта   Эта статья полезна?          \nС помощью инструкции создадим образ с простым статическим сайтом.\nЗатем загрузим образ в Artifact Registry и развернем сайт в кластере Managed Kubernetes.\n\n## Перед началом работы\n1. Установите kubectl и Docker Desktop.\n2. Создайте сервисный аккаунт с ролью «Администратор проекта».\n3. Сгенерируйте ключи доступа для сервисного аккаунта.\nРекомендуем сохранить ключи доступа в системе управления паролями, например Secret Management.\nОни пригодятся для подключения к кластеру и аутентификации в Artifact Registry.\n4. Создайте кластер с публичным IP и группу узлов.\n5. Подключитесь к кластеру.\n\n## Подготовьте файлы сайта\nСайт в примере содержит два файла — index.html и pic.png.\n \n Пример index.html \n \n\n## Подготовьте спецификации\nПеред началом сборки образа создайте спецификации для nginx и Dockerfile:\n1. Создайте каталог cloudru-app-example.\n2. Переместите в созданный каталог файлы index.html и pic.png.\n3. В каталоге cloudru-app-example создайте конфигурационный файл с названием nginx.conf.\n4. Добавьте в nginx.conf спецификацию:\n```\nserver {    listen 8080 default_server;    listen [::]:8080 default_server;    root /usr/share/nginx/html;    index index.html;    location / {        try_files $uri $uri/ =404;    }}\n```\n5. В каталоге cloudru-app-example создайте файл с названием Dockerfile и добавьте спецификацию:\n```\n# nginx imageFROM nginx:stable# Port for start serviceEXPOSE 8080# nginx config (nginx.conf)COPY nginx.conf /etc/nginx/conf.d/nginx.conf# Site artifactsCOPY index.html /usr/share/nginx/html/index.htmlCOPY pic.png /usr/share/nginx/html/pic.pngSTOPSIGNAL SIGQUITCMD [\"nginx\", \"-g\", \"daemon off;\"]\n```\n\n## Соберите Docker-образ\n1. Перейдите в каталог cloudru-app-example и запустите сборку образа с помощью команды:\n```\ndocker build -t cloudru-app-example .\n```\n2. В Docker Desktop перейдите на вкладку Images → Local и проверьте, что образ cloudru-app-example появился в списке.\n\n## Загрузите образ в Artifact Registry\n1. В Artifact Registry создайте реестр.\n2. Пройдите аутентификацию в Artifact Registry для работы с Docker-образами.\nИспользуйте сервисный аккаунт, полученный перед началом работы.\n3. Выполните команду:\n```\ndocker tag cloudru-app-example <uri_registry>/cloudru-app-example:v1\n```\n\nГде:\n- cloudru-app-example — образ с сайтом.\n- <uri_registry> — URI реестра Artifact Registry.\nЧтобы посмотреть или скопировать URI реестра, в личном кабинете перейдите в Artifact Registry → Реестры.\nURI реестра доступен в списке напротив нужного реестра.\n4. Загрузите образ:\n```\ndocker push <uri_registry>/cloudru-app-example:v1\n```\n5. Проверьте, что образ отобразился в списке репозитория.\nСм.также Загрузка Docker-образа в репозиторий Artifact Registry\n\n## Подготовьте манифесты для приложения\n1. Создайте файл cloudru-app-example.yaml и сохраните следующий манифест:\n```\napiVersion: apps/v1kind: Deploymentmetadata:  name: cloudru-app-examplespec:  selector:    matchLabels:      run: cloudru-app-example  replicas: 1  template:    metadata:      labels:        run: cloudru-app-example    spec:      containers:        - name: cloudru-app-example          image: <uri_registry>/cloudru-app-example:v1          ports:            - containerPort: 8080\n```\n\nГде:\n- spec.template.spec.containers.image — путь до образа в Artifact Registry.\n- spec.replicas — количество реплик приложения.\nВ Managed Kubernetes автоматически создается секрет для Artifact Registry.\nПри создании ресурса этот секрет будет добавлен Admission-контроллером в поле imagePullSecret, если в манифесте поле не указано явно.\nЧтобы использовать свой секрет, добавьте в манифест imagePullSecret:\n```\nimagePullSecrets:  - name: <your-secret-name>\n```\n\n1. В корневом каталоге создайте cloudru-app-example-lb.yaml и добавьте следующую спецификацию:\n```\napiVersion: v1kind: Servicemetadata:  name: cloudru-app-example-lb  labels:    run: cloudru-app-examplespec:  selector:    run: cloudru-app-example  ports:    - port: 8080      targetPort: 8080  type: LoadBalancer\n```\n\n## Разверните приложение\nЧтобы развернуть приложение, выполните команды:\n```\nkubectl apply -f cloudru-app-example.yamlkubectl apply -f cloudru-app-example-lb.yaml\n```\n\nРезультат будет следующим:\n```\ndeployment.apps/cloudru-app-example createdservice/cloudru-app-example-lb created\n```\n\nПримечание Развертывание приложения займет 2–3 минуты.\nПроверьте статус выполнения развертывания подов:\n```\nkubectl get pod\n```\n\nЕсли под с приложением находится в статусе «Running», развертывание прошло успешно.\nЧтобы получить адрес для доступа к сайту, выполните команду:\n```\nkubectl get svc\n```\n\nВ ответе будут доступны EXTERNAL-IP и PORT(S) для сервиса cloudru-app-example-lb.\nДоступ к сайту можно получить по URL формата http://EXTERNAL-IP:PORT.\n\n  [© 2025 Cloud.ru](https://cloud.ru)",
      "debug": {
        "start_page": 1,
        "end_page": 1
      }
    }
  ]
}