{
  "title": "Развертывание сервиса видеоконференций Jitsi на виртуальной машине",
  "chapters": [
    {
      "name": "Развертывание сервиса видеоконференций Jitsi на виртуальной машине",
      "content": "Практические руководства Evolution    \n\n # Развертывание сервиса видеоконференций Jitsi на виртуальной машине   Эта статья полезна?          \nС помощью этого руководства вы развернете сервис видеоконференций Jitsi на бесплатной виртуальной машине в облаке Cloud.ru Evolution.\nВы создадите инфраструктуру, развернете сервис видеоконференций и опубликуете его на сервере Nginx, обеспечив безопасный доступ по HTTPS.\nВ результате вы получите работающее окружение Jitsi, полностью готовое к использованию.\nВы будете использовать следующие сервисы:\n- Виртуальная машина free tier — сервис, в рамках которого предоставляется бесплатная виртуальная машина с готовой конфигурацией.\n- Публичный IP-адрес — для доступа к приложению через интернет.\n- Docker — система контейнеризации.\n- Docker Compose — инструмент для запуска и управления Docker-контейнерами.\n- Jitsi — сервис видеоконференций с открытым исходным кодом.\n- Бесплатный сервис nip.io для получения публичного доменного имени и сертификата.\nВы также можете использовать собственное зарегистрированное доменное имя и SSL-сертификат для организации доступа.\n- Nginx — веб-сервер для проксирования запросов и организации защищeнного HTTPS-доступа к приложению.\n- Let’s Encrypt — сервис для автоматического получения бесплатного SSL-сертификата.\nШаги:\n1. Разверните ресурсы в облаке.\n2. Настройте окружение на виртуальной машине.\n3. Настройте Nginx и HTTPS.\n4. Разверните приложение.\n5. Удалите доступ по SSH для виртуальной машины.\n\n## Перед началом работы\n1. Зарегистрируйтесь в личном кабинете Cloud.ru.\nЕсли вы уже зарегистрированы, войдите под своей учетной записью.\n2. Сгенерируйте ключевую пару и загрузите публичный ключ в Cloud.ru Evolution.\n\n## 1. Разверните ресурсы в облаке\nНа этом шаге вы создадите группу безопасности и виртуальную машину.\n1. Создайте бесплатную виртуальную машину со следующими параметрами:\n- Название: meet-service.\n- Образ: публичный образ Ubuntu 22.04.\n- Подключить публичный IP: оставьте опцию включенной.\n- Метод аутентификации: публичный ключ.\n- Публичный ключ: укажите ключ, созданный ранее.\n- Имя хоста: meet-service.\nНа странице Инфраструктура → Виртуальные машины убедитесь, что отображается виртуальная машина meet-service со статусом «Запущена».\n2. Создайте группу безопасности с названием meet-service-sg и добавьте в нее правила:\n Трафик Протокол Порт Тип источника Источник ВходящийTCP443IP-адрес0.0.0.0/0ВходящийTCP80IP-адрес0.0.0.0/0ВходящийTCP4443IP-адрес0.0.0.0/0ВходящийUDP10000IP-адрес0.0.0.0/0ВходящийUDP3478IP-адрес0.0.0.0/0Исходящий Любой Оставьте пустымIP-адрес0.0.0.0/0\nНа странице Сети → Группы безопасности убедитесь, что отображается группа безопасности meet-service-sg со статусом «Создана».\n3. Назначьте созданную группу безопасности виртуальной машине meet-service.\nУбедитесь, что в личном кабинете на странице сервиса «Виртуальные машины», в разделе Сетевые параметры отображается группа безопасности meet-service-sg.\n\n## 2. Настройте окружение на виртуальной машине\nНа этом шаге вы установите необходимые пакеты и настроите систему на виртуальной машине.\n1. Подключитесь к виртуальной машине meet-service по SSH.\n2. Обновите систему и установите необходимые зависимости:\n```\nsudo apt update && sudo apt upgrade -y &&\\sudo apt install -y curl apt-transport-https\\                         ca-certificates\\                         software-properties-common\\                         gnupg2\\                         lsb-release\\                         unzip\n```\n3. Установите Docker:\n```\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpgecho \"deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/nullsudo apt updatesudo apt install docker-ce docker-ce-cli containerd.io -y\n```\n4. Дайте текущему пользователю права на запуск Docker:\n```\nsudo usermod -aG docker $USERnewgrp docker\n```\n5. Установите Docker Compose:\n```\nsudo apt-get install docker-compose-plugin -y\n```\n6. Проверьте, что Docker и Docker Compose установлены корректно:\n```\ndocker --versiondocker compose version\n```\n7. Установите и запустите Nginx:\n```\nsudo apt install nginx -ysudo systemctl enable nginxsudo systemctl start nginx\n```\n8. Установите Let’s Encrypt и плагин для Nginx:\n```\nsudo apt install certbot python3-certbot-nginx -y\n```\n\n## 3. Настройте Nginx и HTTPS\nНа этом шаге вы настроите службу Nginx и обеспечите доступ по HTTPS.\n1. Подключитесь к виртуальной машине meet-service по SSH.\n2. Настройте межсетевой экран:\n```\nsudo ufw allow OpenSSHsudo ufw allow 'Nginx Full'sudo ufw allow 10000/udp comment 'JVB media traffic'sudo ufw allow 4443/tcp comment 'JVB TCP fallback'\nsudo ufw enable\n```\n3. Создайте конфигурационный файл Nginx:\n```\nsudo nano /etc/nginx/sites-available/meet.conf\n```\n4. Вставьте конфигурацию, заменив <ip_address> на публичный IP-адрес виртуальной машины meet-service.\n```\nserver {   listen 80;   server_name meet.<ip_address>.nip.io www.meet.<ip_address>.nip.io;\n   # Основной прокси к Jitsi Web   location / {      proxy_pass http://localhost:8000;      proxy_set_header Host $host;      proxy_set_header X-Real-IP $remote_addr;      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;      proxy_set_header X-Forwarded-Proto $scheme;   }\n   # WebSocket прокси для XMPP   location /xmpp-websocket {      proxy_pass http://127.0.0.1:5280/xmpp-websocket;      proxy_http_version 1.1;      proxy_set_header Upgrade $http_upgrade;      proxy_set_header Connection \"upgrade\";      proxy_set_header Host $host;      proxy_set_header X-Real-IP $remote_addr;      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;      tcp_nodelay on;   }\n   # BOSH прокси для XMPP   location /http-bind {      proxy_pass http://localhost:5280/http-bind;      proxy_set_header X-Forwarded-For $remote_addr;      proxy_set_header Host $http_host;   }}\n```\n5. Активируйте конфигурацию и перезапустите Nginx:\n```\nsudo ln -sf /etc/nginx/sites-available/meet.conf /etc/nginx/sites-enabled/meet.confsudo rm -f /etc/nginx/sites-enabled/defaultsudo nginx -tsudo systemctl reload nginx\n```\n6. Проверьте, что Nginx работает:\n```\nsudo systemctl status nginx\n```\n\nСервис Nginx должен быть в статусе «active (running)».\n7. Перейдите по адресу http://meet.<ip_address>.nip.io.\nОткроется страница с текстом «502 Bad Gateway».\n8. Выпустите SSL-сертификат:\n```\nsudo certbot --nginx -d meet.<ip_address>.nip.io --redirect --agree-tos -m <email>\n```\n\nГде:\n- <ip_address> — публичный IP-адрес виртуальной машины meet-service.\n- <email> — email для регистрации сертификата.\n9. После выпуска сертификата перейдите по адресу https://meet.<ip_address>.nip.io.\nОткроется страница с текстом «502 Bad Gateway».\nВ свойствах сайта браузер отметит соединение как безопасное.\n\n## 4. Разверните приложение\nРазверните серверное приложение Jitsi с помощью Docker Compose.\n1. Подключитесь к виртуальной машине meet-service по SSH.\n2. Скачайте стабильную версию Jitsi:\n```\nwget $(wget -q -O - https://api.github.com/repos/jitsi/docker-jitsi-meet/releases/234931998 | grep zip | cut -d\\\" -f4)\n```\n3. Распакуйте архив Jitsi:\n```\nunzip stable-10431\n```\n4. Перейдите в директорию приложения:\n```\ncd jitsi-docker-jitsi-meet-*\n```\n5. Создайте файл .env:\n```\ncp env.example .env\n```\n6. Сгенерируйте пароли:\n```\n./gen-passwords.sh\n```\n7. Создайте директории для конфигурации:\n```\nmkdir -p ~/.jitsi-meet-cfg/{web,transcripts,prosody/config,prosody/prosody-plugins-custom,jicofo,jvb,jigasi,jibri}\n```\n8. Откройте файл .env на редактирование:\n```\nnano .env\n```\n9. Замените или вставьте следующие значения, оставив остальные по умолчанию:\n```\nCONFIG=~/.jitsi-meet-cfgHTTP_PORT=8000HTTPS_PORT=8443TZ=Europe/MoscowPUBLIC_URL=https://meet.<ip_address>.nip.ioJVB_ADVERTISE_IPS=<ip_address>DISABLE_HTTPS=1ENABLE_HTTP_REDIRECT=0ENABLE_LETSENCRYPT=0JVB_PORT=10000\n```\n\nГде <ip_address> — публичный IP-адрес виртуальной машины meet-service.\n10. Откройте файл docker-compose.yml на редактирование:\n```\nnano docker-compose.yml\n```\n11. Добавьте следующий код на строку 200 в конфигурацию сервиса prosody:\n```\nports:   - \"127.0.0.1:5280:5280\"\n```\n12. Запустите сервис:\n```\ndocker compose up -d\n```\n13. Проверьте, что сервис запущен:\n```\ndocker compose ps\n```\n14. Перейдите по адресу https://meet.<ip_address>.nip.io.\nОтобразится страница сервера видеоконференций Jitsi.\n\n## 5. Отключите SSH-доступ\nКогда вы развернули и настроили сервис, закройте доступ по SSH для повышения безопасности.\n1. В личном кабинете на верхней панели слева нажмите  и выберите Инфраструктура → Виртуальные машины.\n2. В списке виртуальных машин выберите meet-service.\n3. Перейдите на вкладку Сетевые параметры.\n4. В блоке сетевого интерфейса нажмите  и выберите Изменить группы безопасности.\n5. Удалите группу SSH-access_ru и сохраните изменения.\n6. Убедитесь, что доступа нет — попробуйте подключиться к виртуальной машине по SSH.\nПосле отключения доступа по SSH, администрирование сервиса будет доступно через серийную консоль виртуальной машины.\n\n## Результат\nВы развернули сервис видеоконференций Jitsi на бесплатной виртуальной машине в облаке Cloud.ru с публикацией по HTTPS.\nПолученные навыки помогут вам создавать сервисы с использованием облачной инфраструктуры.\n\n  [© 2025 Cloud.ru](https://cloud.ru)",
      "debug": {
        "start_page": 1,
        "end_page": 1
      }
    }
  ]
}