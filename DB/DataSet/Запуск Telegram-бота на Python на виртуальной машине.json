{
  "title": "Запуск Telegram-бота на Python на виртуальной машине",
  "chapters": [
    {
      "name": "Запуск Telegram-бота на Python на виртуальной машине",
      "content": "Практические руководства Evolution    \n\n # Запуск Telegram-бота на Python на виртуальной машине   Эта статья полезна?          \nС помощью этого руководства вы запустите Telegram-бота на Python на виртуальной машине.\nВы будете использовать следующие сервисы:\n- Виртуальная машина free tier — сервис, в рамках которого предоставляется бесплатная виртуальная машина с готовой конфигурацией.\n- Публичный IP-адрес для организации работы с Telegram через webhook.\n- Бесплатный сервис nip.io для получения публичного доменного имени и сертификата.\nВы также можете использовать собственное зарегистрированное доменное имя и SSL-сертификат для организации доступа.\nШаги:\n1. Создайте виртуальную машину.\n2. Настройте группу безопасности.\n3. Зарегистрируйте бота в Telegram.\n4. Подготовьте и запустите код бота.\n5. Протестируйте работу бота.\n\n## Перед началом работы\nЗарегистрируйтесь в личном кабинете Cloud.ru.\nЕсли вы уже зарегистрированы, войдите под своей учетной записью.\n\n## 1. Создайте виртуальную машину\nСоздайте бесплатную виртуальную машину со следующими параметрами:\n1. В поле Название укажите название виртуальной машины, например telegram-bot-server.\n2. На вкладке Публичные выберите образ Ubuntu 22.04.\n3. Назначьте публичный IP-адрес виртуальной машине — оставьте включенной опцию Подключить публичный IP. Для виртуальной машины будет арендован и назначен прямой публичный IP.\n4. В поле Логин укажите логин пользователя виртуальной машины, например user1.\n5. Выберите метод аутентификации — пароль.\n6. В поле Имя хоста укажите уникальное имя устройства, по которому можно идентифицировать виртуальную машину в сети, например telegram-bot-server.\nУбедитесь, что в личном кабинете на странице сервиса «Виртуальные машины»:\n- отображается виртуальная машина telegram-bot-server;\n- статус виртуальной машины — «Запущена»;\n- виртуальной машине назначен публичный IP-адрес.\n\n## 2. Настройте группу безопасности\nГруппы безопасности в облаке Evolution позволяют контролировать входящий и исходящий трафик для создаваемых ресурсов.\nВы настроите правила фильтрации трафика — разрешите весь исходящий трафик.\nСоздайте новую группу безопасности со следующими параметрами:\n1. Выберите Зону доступности, в которой необходимо разместить группу безопасности. Укажите ту же зону доступности, что выбрана для виртуальной машины telegram-bot-server.\n2. Укажите Название группы безопасности, например telegram-bot-server.\n3. Добавьте правило исходящего трафика:\n1. Протокол — любой\n2. Порт — оставьте пустым\n3. Тип адресата — IP-адрес\n4. Адресат — 0.0.0.0/0\n4. Назначьте созданную группу безопасности виртуальной машине telegram-bot-server.\nЕсли в группе безопасности присутствуют другие виртуальные машины, исключите их из группы.\nУбедитесь, что в личном кабинете на странице сервиса «Виртуальные машины», в разделе Сетевые параметры отображается группа безопасности telegram-bot-server.\n\n## 3. Зарегистрируйте бота в Telegram\nНа этом шаге вы зарегистрируете в Telegram нового бота и получите его токен.\n1. В Telegram найдите бота BotFather.\n2. Выполните команду /newbot.\n3. Задайте имя (name) и имя пользователя (username) для бота.\nИмя пользователя должно заканчиваться на Bot или _bot.\nВ результате регистрации BotFather сообщит токен бота.\nСохраните его, он понадобится далее.\n4. Убедитесь, что созданный бот отображается в Telegram при поиске по имени.\n\n## 4. Подготовьте и запустите код бота\nДля настройки виртуальной машины вы будете использовать серийную консоль в браузере.\n1. Подключитесь к виртуальной машине telegram-bot-server через серийную консоль.\n2. Обновите индекс пакетов ОС, установите обновления пакетов и необходимые зависимости:\n```\nsudo apt update -ysudo apt upgrade -ysudo apt-get install python3 python3-pip -ypip3 install python-telegram-bot\n```\n3. Создайте отдельную папку для размещения бота и перейдите в нее:\n```\nmkdir ./appcd ./app\n```\n4. Cоздайте файл bot.py:\n```\nnano bot.py\n```\n5. Скопируйте код бота в файл.\n6. В строке 57 замените TOKEN на токен бота, полученный от BotFather.\n7. Измененный код вставьте в серийную консоль.\n8. Нажмите Ctrl + X, затем y, чтобы сохранить изменения.\nТеперь вы запустите бота в качестве службы.\nБот будет работать постоянно и запускаться автоматически при старте или перезагрузке виртуальной машины.\n1. Подключитесь к виртуальной машине telegram-bot-server через серийную консоль.\n2. Создайте файл python-bot.service:\n```\nsudo nano /etc/systemd/system/python-bot.service\n```\n3. Вставьте код в файл:\n```\n[Unit]Description=My Python BotWants=network-online.targetAfter=network-online.target\n[Service]Type=simpleUser=<VM_username>ExecStart=/usr/bin/python3 /home/user1/app/bot.pyWorkingDirectory=/home/user1/app\n[Install]WantedBy=multi-user.target\n```\n\nГде User — имя пользователя виртуальной машины telegram-bot-server.\n4. Нажмите Ctrl + X, затем y, чтобы сохранить изменения.\n5. Перезапустите systemd:\n```\nsudo systemctl daemon-reload\n```\n6. Включите службу python-bot.service:\n```\nsudo systemctl enable python-bot\n```\n7. Запустите службу python-bot.service:\n```\nsudo systemctl start python-bot\n```\n8. Выполните команду:\n```\nsudo systemctl status python-bot\n```\n\nВ результате должен отобразиться статус службы — «Active (running)».\n \n Вывод команды\n\n## 5. Протестируйте работу бота\n1. Найдите в Telegram вашего бота и напишите ему.\nБот поздоровается с вами в начале диалога, а затем будет повторять ваши сообщения.\n2. Перезагрузите виртуальную машину.\n3. Напишите сообщение в бота — бот должен ответить несмотря на перезагрузку сервера.\n\n## Результат\nВы запустили Telegram-бота на Python в качестве службы, используя виртуальную машину.\n\n  [© 2025 Cloud.ru](https://cloud.ru)",
      "debug": {
        "start_page": 1,
        "end_page": 1
      }
    }
  ]
}