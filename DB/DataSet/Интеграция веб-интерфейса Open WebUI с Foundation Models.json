{
  "title": "Интеграция веб-интерфейса Open WebUI с Foundation Models",
  "chapters": [
    {
      "name": "Интеграция веб-интерфейса Open WebUI с Foundation Models",
      "content": "Практические руководства Evolution    \n\n # Интеграция веб-интерфейса Open WebUI с Foundation Models   Эта статья полезна?          \nС помощью этого руководства вы разверните веб-интерфейс Open WebUI на бесплатной виртуальной машине в облаке Cloud.ru Evolution.\nСоздадите виртуальную машину Ubuntu 22.04, назначите ей публичный IP-адрес, установите Docker и Docker Compose, запустите Open WebUI и опубликуете сервис через Nginx с SSL-сертификатом, выпущенным в Let’s Encrypt.\nВ результате вы сконфигурируете Open WebUI для работы с Foundation Models и получите сервис, готовый к работе.\nВы будете использовать следующие сервисы:\n- Foundation Models — сервис для доступа к API популярных фундаментальных моделей машинного обучения с открытым исходным кодом.\n- Виртуальные машины — сервис, в рамках которого предоставляется виртуальная машина.\n- Публичный IP-адрес.\n- Docker — система контейнеризации.\n- Docker Compose — инструмент для запуска и управления Docker-контейнерами.\n- Бесплатный сервис nip.io для получения публичного доменного имени и сертификата.\nВы также можете использовать собственное зарегистрированное доменное имя и SSL-сертификат для организации доступа.\n- Nginx — веб-сервер для проксирования запросов и организации защищeнного HTTPS-доступа к приложению.\n- Let’s Encrypt — сервис для автоматического получения бесплатного SSL-сертификата.\n- Open WebUI — веб-интерфейс с открытым исходным кодом для работы с различными моделями искусственного интеллекта.\n\n## Шаги:\n1. Разверните необходимые ресурсы в облаке.\n2. Сгенерируйте API-ключ для доступа к Foundation Models.\n3. Настройте окружение на виртуальной машине.\n4. Настройте Nginx и HTTPS.\n5. Разверните приложение Open WebUI.\n6. Отключите доступ по SSH для виртуальной машины.\n\n## Перед началом работы\n1. Зарегистрируйтесь в личном кабинете Cloud.ru.\nЕсли вы уже зарегистрированы, войдите под своей учетной записью.\n2. Сгенерируйте SSH-ключ.\n3. Загрузите публичную часть SSH-ключа в облако Cloud.ru Evolution.\n\n## 1. Разверните необходимые ресурсы в облаке\nНа этом шаге вы создадите группу безопасности и виртуальную машину.\n1. Создайте группу безопасности с названием open-web-ui и добавьте в нее правила:\n- Правило входящего трафика 1:\n\n- Протокол: TCP\n- Порт: 443\n- Тип источника: IP-адрес\n- Источник: 0.0.0.0/0\n- Правило входящего трафика 2:\n\n- Протокол: TCP\n- Порт: 80\n- Тип источника: IP-адрес\n- Источник: 0.0.0.0/0\n- Правило исходящего трафика:\n\n- Протокол: Любой\n- Тип адресата: IP-адрес\n- Адресат: 0.0.0.0/0\n2. На странице Сети → Группы безопасности убедитесь, что отображается группа безопасности open-web-ui со статусом «Создана».\n3. Создайте бесплатную виртуальную машину со следующими параметрами:\n- Название: open-web-ui\n- Образ: публичный образ Ubuntu 22.04\n- Подключить публичный IP: включено\n- Публичный IP: Арендовать новый\n- Группы безопасности: SSH-access_ru.AZ-1, open-web-ui\n- Логин: openwebui\n- Метод аутентификации: Публичный ключ и Пароль\n- Публичный ключ: укажите ранее созданный SSH-ключ\n- Пароль: задайте надежный пароль\n- Имя хоста: open-web-ui\n4. На странице Инфраструктура → Виртуальные машины убедитесь, что отображается виртуальная машина open-web-ui со статусом «Запущена».\n\n## 2. Сгенерируйте API-ключ для доступа к Foundation Models\nСледуйте инструкции по созданию API-ключа для Foundation Models.\nСохраните API-ключ, он будет использоваться для конфигурации сервиса.\n1. На верхней панели слева нажмите  и перейдите в раздел Пользователи, на вкладку Сервисные аккаунты.\n2. Нажмите на название сервисного аккаунта, который будете использовать для отправки запроса к модели.\n3. Перейдите на вкладку API-ключи.\n4. Нажмите Создать API-ключ.\n5. Введите название и описание API-ключа, которое поможет в будущем идентифицировать его среди других ключей.\n6. Заполните параметры API-ключа:\n- Сервисы — Foundation Models.\n- Время действия — срок действия API-ключа и часовой пояс.\nВы можете установить значение от одного дня до одного года с текущей даты.\nЕсли параметр не задан, срок действия ключа устанавливается на максимальное значение — один год.\nС целью повышения уровня безопасности рекомендуется выставлять средние значения, например 90 дней.\n- Интервал работы ключа — один или несколько интервалов времени, в которые можно использовать API-ключ.\n7. Нажмите Создать.\n8. Сохраните Key Secret.\nПосле закрытия окна получить его будет нельзя.\nСозданный API-ключ появится в списке ключей в статусе «Активен».\nПодробнее о работе с API-ключом.\n\n## 3. Настройте окружение на виртуальной машине\nНа этом шаге вы установите необходимые пакеты и настроите систему на виртуальной машине.\n1. Подключитесь к виртуальной машине open-web-ui через серийную консоль или по SSH.\n2. Обновите систему и установите необходимые зависимости:\n```\nsudo apt update && sudo apt upgrade -y &&\\sudo apt install -y curl apt-transport-https\\                   ca-certificates\\                   software-properties-common\\                   gnupg2\\                   lsb-release\n```\n3. После обновления желательно перезагрузить машину:\n```\nsudo reboot\n```\n4. Установите Docker:\n```\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpgecho \"deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/nullsudo apt updatesudo apt install docker-ce docker-ce-cli containerd.io -y\n```\n5. Дайте текущему пользователю права на запуск Docker:\n```\nsudo usermod -aG docker $USERnewgrp docker\n```\n6. Установите Docker Compose:\n```\nsudo apt-get install docker-compose -y\n```\n7. Проверьте, что Docker и Docker Compose установлены корректно:\n```\ndocker --versiondocker compose version\n```\n8. Установите сервер Nginx:\n```\nsudo apt install nginx -ysudo systemctl start nginxsudo systemctl enable nginx\n```\n9. Установите Let’s Encrypt и плагин для Nginx:\n```\nsudo apt install certbot python3-certbot-nginx -y\n```\n\n## 4. Настройте Nginx и HTTPS\nНа этом шаге настройте службу Nginx и обеспечьте доступ по HTTPS.\n1. Подключитесь к виртуальной машине open-web-ui через серийную консоль или по SSH.\n2. Настройте файервол:\n```\nsudo ufw allow OpenSSHsudo ufw allow 'Nginx Full'sudo ufw enable\n```\n3. Создайте конфигурационный файл:\n```\nsudo nano /etc/nginx/sites-available/openwebui.conf\n```\n4. Вставьте конфигурацию, заменив <ip-address> на IP-адрес вашей виртуальной машины:\n```\nserver {   listen 80;   server_name webui.<ip-address>.nip.io www.webui.<ip-address>.nip.io;\n   location / {      proxy_pass http://localhost:8080;      proxy_set_header Host $host;      proxy_set_header X-Real-IP $remote_addr;      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\nproxy_http_version 1.1;proxy_set_header Upgrade $http_upgrade;proxy_set_header Connection \"upgrade\";   }}\n```\n5. Примените конфигурацию и перезапустите Nginx:\n```\nsudo ln -sf /etc/nginx/sites-available/openwebui.conf /etc/nginx/sites-enabled/openwebui.confsudo rm -f /etc/nginx/sites-enabled/defaultsudo nginx -tsudo systemctl reload nginx\n```\n6. Проверьте, что Nginx работает:\n```\nsudo systemctl status nginx\n```\n\nСервис Nginx должен быть в статусе «active (running)».\n7. Перейдите по адресу http://webui.<ip-address>.nip.io.\nОткроется страница с текстом «502 Bad Gateway».\n8. Запустите команду для выпуска SSL-сертификата:\n```\nsudo certbot --nginx -d webui.<ip-address>.nip.io --redirect --agree-tos -m <email>\n```\n\nГде:\n- <ip-address> — IP-адрес вашей виртуальной машины.\n- <email> — email для регистрации сертификата.\n9. После выпуска сертификата перейдите по адресу https://webui.<ip-address>.nip.io.\nОткроется страница с текстом «502 Bad Gateway».\nВ свойствах сайта браузер отметит соединение как безопасное.\n\n## 5. Разверните приложение Open WebUI\nРазверните серверное приложение Open WebUI с помощью Docker Compose.\n1. Подключитесь к виртуальной машине open-web-ui через серийную консоль или по SSH.\n2. Создайте структуру проекта:\n```\nmkdir -p $HOME/openwebuicd $HOME/openwebui\n```\n3. Создайте файл docker-compose.yml:\n```\nnano docker-compose.yml\n```\n4. Вставьте содержимое в файл docker-compose.yml:\n```\nservices:  open-web-ui:   image: ghcr.io/open-webui/open-webui:latest   ports:      - '8080:8080'   env_file:      - ./.env   volumes:      - open-web-ui:/app/backend/data   restart: always\nvolumes:  open-web-ui:\n```\n5. Создайте файл конфигурации .env:\n```\nnano .env\n```\n6. Вставьте содержимое в файл, заменив переменные на значения:\n```\nOPENAI_API_BASE_URL=https://foundation-models.api.cloud.ru/v1/OPENAI_API_KEY=<api-key>\n```\n\nГде <api-key> — ключ для доступа к сервису Foundation Models, сгенерированный на шаге 2.\n7. Запустите сервис:\n```\ndocker-compose up -d\n```\n8. Проверьте, что сервис запущен:\n```\ndocker compose ps\n```\n9. Перейдите по адресу https://webui.<ip-address>.nip.io.\nОткроется страница Open WebUI, при первом входе система попросит ввести регистрационные данные Администратора.\n10. В интерфейсе Open WebUI выберите модель для работы.\n11. Введите ваш запрос в чат и получите ответ от LLM-модели Foundation Models.\n\n## 6. Отключите доступ по SSH для виртуальной машины\nДля повышения безопасности закройте доступ по SSH, после того как вы развернули и настроили сервис.\n1. В личном кабинете Cloud.ru на верхней панели слева нажмите  и выберите Инфраструктура → Виртуальные машины.\n2. В списке виртуальных машин выберите open-web-ui.\n3. Перейдите на вкладку Сетевые параметры.\n4. В строке подсети нажмите  и выберите Изменить группы безопасности.\n5. Удалите группу SSH-access_ru и сохраните изменения.\n6. Убедитесь, что доступа нет — попробуйте подключиться к виртуальной машине по SSH.\nПосле отключения доступа по SSH, администрирование сервиса будет доступно через серийную консоль виртуальной машины.\n\n## Результат\nВ данной лабораторной работе вы развернули чат-сервис для работы в облаке Cloud.ru с сетевой изоляцией и публикацией по HTTPS.\nПолученные навыки помогут вам создавать AI-сервисы с использованием сервисов Foundation Models.\nВы можете добавить аутентификацию по SSO или подключить внешнее S3 хранилище для хранения файлов, которые пользователи добавляют в Open WebUI при работе с моделями, например, Evolution Object Storage.\n\n  [© 2025 Cloud.ru](https://cloud.ru)",
      "debug": {
        "start_page": 1,
        "end_page": 1
      }
    }
  ]
}