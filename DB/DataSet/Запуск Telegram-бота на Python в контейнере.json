{
  "title": "Запуск Telegram-бота на Python в контейнере",
  "chapters": [
    {
      "name": "Запуск Telegram-бота на Python в контейнере",
      "content": "Практические руководства Evolution    \n\n # Запуск Telegram-бота на Python в контейнере   Эта статья полезна?          \nС помощью этого руководства вы запустите Telegram-бота на Python в контейнере.\nВы будете использовать следующие сервисы:\n- Artifact Registry для хранения, совместного использования и управления Docker-образами и Helm-чартами.\n- Container Apps — сервис для запуска контейнерных приложений в облаке. Не требует знания Kubernetes и создания виртуальных машин.\n- Систему контроля версий GitVerse.\nВ GitVerse находится готовый образ Telegram-бота.\nШаги:\n1. Подготовьте среду.\n2. Клонируйте или скачайте репозиторий кода c GitVerse.\n3. Зарегистрируйте Telegram-бота.\n4. Соберите образ и присвойте тег.\n5. Загрузите Docker-образ в реестр.\n6. Создайте и запустите контейнер.\n7. Добавьте вебхук в Telegram.\n8. Проверьте работу Telegram-бота.\n\n## Перед началом работы\nЗарегистрируйтесь в личном кабинете Cloud.ru.\nЕсли вы уже зарегистрированы, войдите под своей учетной записью.\n\n## 1. Подготовьте среду\nПодготовьте среду, если не сделали этого ранее.\n\n## 2. (Опционально) Клонируйте или скачайте репозиторий кода c GitVerse\nВы можете зарегистрироваться в GitVerse, если у вас еще нет аккаунта, и познакомиться с новой системой контроля версий. Этот шаг необязательный и не влияет на дальнейшее прохождение сценария.\nВ этом репозитории находится готовый образ Telegram-бота на языке Python.\n```\ngit clone https://gitverse.ru/cloudru/evo-containerapp-telegrambot-webhook-python-sample\n```\n\n## 3. Зарегистрируйте Telegram-бота\n1. В Telegram найдите BotFather.\n2. Выполните команду /newbot.\n3. Задайте имя (name) и имя пользователя (username) для бота.\nИмя пользователя должно оканчиваться на ...Bot или ..._bot.\nВ нашем случае:\n- name: new-bot\n- username: botforlabbot\nВ результате вы получите токен. Сохраните его — он потребуется на следующих этапах.\n4. С помощью команды /setuserpic установите иконку для вашего бота.\n\n## 4. Соберите образ и присвойте тег\nСоберите образ и присвойте ему тег, выполнив следующую команду:\n```\ndocker build --tag <registry_name>.cr.cloud.ru/telegram-bot-example https://gitverse.ru/cloudru/evo-containerapp-telegrambot-webhook-python-sample.git#master --platform linux/amd64\n```\n\nГде <registry_name> — название реестра, которое вы указывали при его создании в Artifact Registry.\nДля создания контейнера Docker-образ должен быть собран под платформу linux/amd64, поэтому в команде используется флаг platform со значением linux/amd64.\n\n## 5. Загрузите Docker-образ в реестр\n1. Загрузите образ в реестр Artifact Registry, выполнив команду:\n```\ndocker push <registry_name>.cr.cloud.ru/telegram-bot-example\n```\n\nГде:\n- <registry_name> — название реестра, которое вы указывали при его создании в Artifact Registry.\n- telegram-bot-example — название будущего репозитория в Artifact Registry. Название репозитория соответствует имени Docker-образа.\n2. В личном кабинете перейдите в раздел с Реестры → Репозитории → Артефакты сервиса Artifact Registry и убедитесь, что образ загружен.\n\n## 6. Создайте и запустите контейнер\n1. Перейдите в сервис Container Apps через меню в левом верхнем углу экрана.\n2. Выберите Container Services и нажмите Создать.\n3. Укажите название контейнера и активируйте опцию Публичный адрес.\n4. Нажмите Продолжить.\n5. Выберите реестр, репозиторий и тег Docker-образа, который вы загрузили в Artifact Registry.\n6. Укажите порт контейнера — 5000.\n7. Перейдите на вкладку Переменные и добавьте переменную окружения BOT_TOKEN.\nВ значение переменной укажите токен, полученный при регистрации бота в BotFather.\n8. Нажмите Продолжить.\n9. Задайте количество ресурсов:\n- vCPU и RAM: 0.5 vCPU – 1024 MB\n- Минимальное количество экземпляров: 0\n- Максимальное количество экземпляров: 1\n10. Нажмите Создать.\n11. Дождитесь, когда контейнер и ревизия перейдут в статус «Выполняется».\n\n## 7. Добавьте вебхук в Telegram\nЧтобы бот получал сообщения из Telegram, добавьте вебхук:\n1. Откройте любой браузер.\n2. В адресной строке введите по очереди запросы.\n1. Проверьте, существуют ли вебхуки:\n```\nhttps://api.telegram.org/bot{BOT_TOKEN}/getWebhookInfo\n```\n\n{BOT_TOKEN} здесь и далее — токен, который был сгенерирован при регистрации бота в BotFather.\n2. Удалите существующие вебхуки:\n```\nhttps://api.telegram.org/bot{BOT_TOKEN}/deleteWebhook\n```\n3. Добавьте новый вебхук:\n```\nhttps://api.telegram.org/bot{BOT_TOKEN}/setWebhook?url={PUBLIC_URL}/{BOT_TOKEN}\n```\n\n{PUBLIC_URL} — публичный URL-адрес, который был сгенерирован при создании контейнера в Container Apps.\n\n## 8. Проверьте работу Telegram-бота\nВызовите бота в Telegram по имени пользователя (username) и проверьте его работу, выполнив команду /start.\n\n## Результат\nВы научились разворачивать Telegram-бота в контейнере.\n\n  [© 2025 Cloud.ru](https://cloud.ru)",
      "debug": {
        "start_page": 1,
        "end_page": 1
      }
    }
  ]
}