{
  "title": "Настройка пайплайна CI_CD в GitHub, GitLab и GitVerse с использованием Artifact Registry",
  "chapters": [
    {
      "name": "Настройка пайплайна CI_CD в GitHub, GitLab и GitVerse с использованием Artifact Registry",
      "content": "Практические руководства Evolution    \n\n # Настройка пайплайна CI/CD в GitHub, GitLab и GitVerse с использованием Artifact Registry   Эта статья полезна?          \nС помощью этого руководства вы научитесь создавать процесс автоматической сборки и публикации Docker-образа из системы контроля версий GitHub, GitLab или GitVerse в Artifact Registry.\nА также настроите автоматическое развертывание ревизии контейнера в Container Apps.\nВы будете использовать следующие сервисы:\n- Artifact Registry для хранения, совместного использования и управления Docker-образами и Helm-чартами.\n- Container Apps — сервис для запуска контейнерных приложений в облаке. Не требует знания Kubernetes и создания виртуальных машин.\n- Систему контроля версий: GitHub, GitLab или GitVerse.\nШаги:\n1. Подготовьте среду.\n2. Настройте пайплайн CI/CD в системе контроля версий.\n3. Настройте автоматическое развертывание контейнера.\n\n## Перед началом работы\nЗарегистрируйтесь в личном кабинете Cloud.ru.\nЕсли вы уже зарегистрированы, войдите под своей учетной записью.\n\n## 1. Подготовьте среду\nПодготовьте среду, если не сделали этого ранее.\n\n## 2. Настройте пайплайн CI/CD в системе контроля версий\nGitHubGitLabGitVerse Вы можете создавать пайплайны непрерывной интеграции и непрерывного развертывания (CI/CD) с помощью GitHub Actions.\n1. Создайте аккаунт в GitHub.\n2. Cделайте форк репозитория Cloud.ru с примером REST API на языках Go, Python, C#, JavaScript.\nРепозиторий содержит готовый код и Dockerfile для сборки Docker-образов приложений.\nОбразы подходят для запуска на платформе linux/amd64.\n3. Перейдите в раздел Actions.\n4. Нажмите кнопку New workflow и перейдите по ссылке Set up workflow youself.\nБудет создан шаблон файла конфигурации в формате .yml в папке .gitub/workflows.\n5. Скопируйте код из репозитория Cloud.ru и добавьте его в созданный YAML-файл.\nЭтот сценарий запускает создание Docker-образа и его загрузку в Artifact Registry.\n6. В YAML‑файле в блоке env укажите URI реестра Artifact Registry в качестве значения ключа CR_URI.\nНапример, helloworld.cr.cloud.ru.\n7. Перейдите в раздел Settings → Secrets and variables → Actions → Variables.\n8. Укажите переменные и их значения, которые будут использоваться в команде docker login для аутентификации в Artifact Registry.\nВ нашем примере YAML‑файла это следующие переменные:\n- EVO_CR_LOGIN — логин персонального ключа доступа;\n- EVO_CR_PWD — пароль персонального ключа доступа.\nЛогин и пароль персонального ключа доступа вы получали на этапе подготовки среды.\n9. После завершения редактирования YAML-файла зафиксируйте и отправьте изменения в свой репозиторий GitHub.\nКоммит запустит пайплайн, каждый шаг которого будет выполняться в порядке, указанном в YAML‑файле.\n10. Убедитесь, что все этапы выполнения сценария сборки завершились успешно.\nВ Artifact Registry вы должны увидеть загруженный образ.\nПри каждом изменении кода в GitHub обновленный образ будет автоматически отправляться в реестр Artifact Registry.\n11. В личном кабинете перейдите в раздел Artifact Registry и убедитесь, что образ появился в реестре.\nСм.также Синтаксис YAML для GitHub Actions\n\n## 3. Настройте автоматическое развертывание контейнера\nЧтобы каждый раз после загрузки в реестр обновленного Docker-образа автоматически создавалась новая ревизия контейнера:\n1. В Artifact Registry откройте меню загруженного образа и нажмите Создать Container App.\n2. Заполните поля и активируйте опции:\n- Название контейнера — глобально уникальное имя, на базе которого формируется адрес вашего приложения в домене *.containers.cloud.ru.\n- Порт контейнера — порт контейнера, который должен совпадать с портом вашего приложения.\nВ этом сценарии используем порт 8080.\n- vCPU/RAM — количество vCPU и RAM, которые выделяются для каждого экземпляра контейнера при обработке вызова.\nВыберите минимальную конфигурацию.\n- Минимальное и максимальное количество экземпляров при масштабировании сервиса. По умолчанию происходит масштабирование с 0, что может вызывать небольшую задержку при старте вашего приложения. Установите минимальное количество экземпляров — 0, а максимальное — 1.\n- Публичный адрес — активируйте опцию, чтобы получить URL-адрес для вызова приложения из интернета.\n- Автоматическое развертывание — активируйте опцию, чтобы каждый раз после загрузки в Artifact Registry новой версии образа на стороне Container Apps автоматически создавалась новая ревизия контейнера.\n3. Нажмите Создать.\nОткроется страница сервиса Container Apps.\nКонтейнер будет запущен в течение нескольких секунд.\nДождитесь, когда контейнер и ревизия перейдут в статус «Выполняется».\nТеперь при каждом изменении кода в системе CI/CD обновленный образ будет автоматически отправляться в реестр Artifact Registry, а на стороне Container Apps будет автоматически создаваться новая ревизия контейнера.\n\n## Результат\nВы создали процесс автоматической сборки и публикации Docker-образа с помощью GitHub, GitLab, GitVerse и Artifact Registry, а также настроили автоматическое развертывание ревизии контейнера из обновленного образа.\n\n  [© 2025 Cloud.ru](https://cloud.ru)",
      "debug": {
        "start_page": 1,
        "end_page": 1
      }
    }
  ]
}