{
  "title": "Kafbat UI для менеджмента и мониторинга кластера Managed Kafka®",
  "chapters": [
    {
      "name": "Kafbat UI для менеджмента и мониторинга кластера Managed Kafka®",
      "content": "Практические руководства Evolution    \n\n # Kafbat UI для менеджмента и мониторинга кластера Managed Kafka®   Эта статья полезна?          \nС помощью этого руководства вы развернете сервис Kafbat UI на виртуальной машине Ubuntu 22.04, создадите Managed Kafka® и свяжете Kafka с Kafbat UI.\nВы будете использовать виртуальную сеть VPC и подсети для связи виртуальной машины и сервиса Managed Kafka®.\nKafbat UI — это бесплатный и легковесный веб-интерфейс с открытым исходным кодом для мониторинга и управления кластерами Kafka, поддерживающий просмотр брокеров, топиков, групп потребителей, браузинг сообщений и работу со схемами Avro/JSON Schema/Protobuf через Schema Registry.\nИнструмент упрощает наблюдаемость потоков данных и ускоряет устранение неполадок, предоставляя мультикластерное управление, создание и конфигурацию топиков, а также дополнительные функции вроде RBAC и маскирования данных.\nВы будете использовать следующие сервисы:\n- Виртуальные машины — сервис, в рамках которого предоставляется виртуальная машина.\n- Managed Kafka® — сервис для развертывания и управления кластерами Kafka®.\n- Публичный IP-адрес — для доступа к сервису через интернет.\n- VPC — изолированная виртуальная сеть для создания безопасной инфраструктуры.\n- Docker — система контейнеризации.\n- Docker Compose — инструмент для запуска и управления Docker-контейнерами.\n- Бесплатный сервис nip.io для получения публичного доменного имени и сертификата.\nВы также можете использовать собственное зарегистрированное доменное имя и SSL-сертификат для организации доступа.\n- Nginx — веб-сервер для проксирования запросов и организации защищeнного HTTPS-доступа к приложению.\n- Let’s Encrypt — сервис для автоматического получения бесплатного SSL-сертификата.\n- Kafbat UI — веб-интерфейс с открытым исходным кодом для мониторинга и управления кластерами Kafka.\nШаги:\n1. Разверните необходимые ресурсы в облаке.\n2. Настройте окружение на виртуальной машине.\n3. Настройте nginx и HTTPS.\n4. Разверните и настройте сервис Kafbat UI.\n5. Удалите доступ по SSH для виртуальной машины.\n\n## Перед началом работы\n1. Зарегистрируйтесь в личном кабинете Cloud.ru.\nЕсли вы уже зарегистрированы, войдите под своей учетной записью.\n2. Создайте и загрузите SSH-ключ в облако.\n\n## 1. Разверните необходимые ресурсы в облаке\n1. Создайте виртуальную сеть с названием kafka-ui-VPC.\n2. Создайте подсеть:\n- Название: kafka-ui-subnet.\n- Адрес: 10.10.1.0/24.\n- VPC: kafka-ui-VPC.\n- DNS-серверы: 8.8.8.8\nУбедитесь, что в личном кабинете на странице сервиса VPC:\n- отображается сеть kafka-ui-VPC;\n- количество подсетей — 1;\n- подсеть kafka-ui-subnet доступна.\n3. Создайте новую группу безопасности со следующими параметрами:\n1. Укажите Название группы безопасности, например kafka-ui.\n2. Добавьте правила входящего и исходящего трафика.\nПравило входящего трафика:\n\n- Протокол: TCP;\n- Порт: 443;\n- Тип источника: IP-адрес;\n- Источник: 0.0.0.0/0.\n\nПравило входящего трафика:\n\n- Протокол: TCP;\n- Порт: 80;\n- Тип источника: IP-адрес;\n- Источник: 0.0.0.0/0.\n\nПравило исходящего трафика:\n\n- Протокол: Любой;\n- Тип адресата: IP-адрес;\n- Адресат: 0.0.0.0/0.\nУбедитесь, что на странице Сети → Группы безопасности отображается группа безопасности kafka-ui со статусом «Создана».\n4. Создайте виртуальную машину со следующими параметрами:\n- Название: kafka-ui.\n- Образ: Публичные → Ubuntu 22.04.\n- Метод аутентификации: SSH-ключ и пароль.\n- SSH-ключ: ваш SSH-ключ.\n- Пароль: ваш пароль.\n- Имя хоста: kafka-ui.\n- Подключить публичный IP: включено.\n- Тип IP-адреса: Прямой.\n- Группы безопасности: SSH-access_ru.AZ-1, kafka-ui.\n- Подсеть: kafka-ui-subnet.\n- Гарантированная доля vCPU: 10%.\n- vCPU: 1.\n- RAM: 1.\nУбедитесь, что в личном кабинете на странице сервиса «Виртуальные машины» отображается виртуальная машина kafka-ui в статуса «Запущена».\n5. Создайте кластер Managed Kafka® со следующими параметрами:\n- Название: kafka-ui.\n- Версия Kafka: 3.9.0.\n- Брокеры: 1.\n- vCPU: 4.\n- RAM: 16.\n- Подсеть: kafka-ui-subnet.\nУбедитесь, что в личном кабинете на странице сервиса «Managed Kafka®» отображается кластер kafka-ui в статусе «Доступен».\n\n## 2. Настройте окружение на виртуальной машине\nНастройте систему и установите необходимые пакеты на виртуальной машине.\n1. Подключитесь к виртуальной машине через серийную консоль или по SSH.\n2. Обновите систему и установите необходимые зависимости:\n```\nsudo apt update && sudo apt upgrade -ysudo apt install unzip gnupg software-properties-common apt-transport-https ca-certificates nginx snapd -ysudo snap install core; sudo snap refresh coresudo snap install --classic certbotsudo ln -s /snap/bin/certbot /usr/bin/certbot\n```\n3. Установите Docker и Docker Compose:\n```\n# Add Docker's GPG keycurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg\n# Add Docker repositoryecho \"deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null\n# Install Dockersudo apt update && sudo apt install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin docker-compose\n# Add user to docker groupsudo usermod -aG docker $USERnewgrp docker\n```\n4. Проверьте, что Docker установлен корректно:\n```\ndocker --versiondocker compose version\n```\n\n## 3. Настройте nginx и HTTPS\nНастройте службу nginx и обеспечьте доступ по HTTPS.\n1. Подключитесь к виртуальной машине через серийную консоль или по SSH.\n2. Сконфигурируйте межсетевой экран:\n```\nsudo ufw allow OpenSSHsudo ufw allow 'Nginx Full'sudo ufw enable\n```\n3. Создайте конфигурационный файл:\n```\nsudo nano /etc/nginx/sites-available/kafkaui.conf\n```\n4. Вставьте конфигурацию, заменив <IP-адрес> на IP-адрес вашей виртуальной машины.\n```\nserver {   listen 80;   server_name kafkaui.<IP-адрес>.nip.io www.kafkaui.<IP-адрес>.nip.io;\n   location / {      proxy_pass         http://localhost:8080;      proxy_http_version 1.1;\n      # WebSocket headers      proxy_set_header Upgrade           $http_upgrade;      proxy_set_header Connection        \"upgrade\";\n      # Preserve original host / IP      proxy_set_header Host              $host;      proxy_set_header X-Real-IP         $remote_addr;      proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;      proxy_set_header X-Forwarded-Proto $scheme;\n      # Timeouts suitable for long-lived Kafbat UI streams      proxy_read_timeout  600s;      proxy_send_timeout  600s;   }}\n```\n5. Примените конфигурацию и перезапустите nginx:\n```\nsudo ln -sf /etc/nginx/sites-available/kafkaui.conf /etc/nginx/sites-enabled/kafkaui.confsudo rm -f /etc/nginx/sites-enabled/defaultsudo nginx -tsudo systemctl reload nginx\n```\n6. Проверьте, что nginx работает:\n```\nsudo systemctl status nginx\n```\n\nСервис nginx должен быть в статусе «active (running)».\n7. Перейдите по адресу http://kafkaui.<IP-адрес>.nip.io.\nОткроется страница с текстом 502 Bad Gateway.\n8. Запустите команду для выпуска SSL-сертификата.\n```\nsudo certbot --nginx -d kafkaui.<IP-адрес>.nip.io --redirect --agree-tos -m <EMAIL>\n```\n\nГде:\n- <IP-адрес> — IP-адрес вашей виртуальной машины.\n- <EMAIL> — ваш email.\n9. После успешного выпуска сертификата перейдите по адресу https://kafkaui.<IP-адрес>.nip.io.\nОткроется страница с текстом 502 Bad Gateway.\nВ свойствах сайта браузер отметит соединение как безопасное.\n\n## 4. Разверните и настройте сервис Kafbat UI\n1. Создайте директорию для приложения и перейдите в нее:\n```\nmkdir kafkauicd kafkaui\n```\n2. Создайте файл docker-compose.yml:\n```\nnano docker-compose.yml\n```\n3. Вставьте содержимое файла:\n```\nservices:   kafbat-ui:      image: kafbat/kafka-ui:47838bd      container_name: kafbat-ui      ports:         - \"8080:8080\"      restart: always\n      # Load credentials from .env      env_file:         - .env\n      environment:         # ---- cluster basics ----         KAFKA_CLUSTERS_0_NAME: kafka-ui         KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS: ${KAFKA_BROKERS}\n         # ---- SASL_PLAINTEXT + SCRAM-SHA-512 ----         KAFKA_CLUSTERS_0_PROPERTIES_SECURITY_PROTOCOL: SASL_PLAINTEXT         KAFKA_CLUSTERS_0_PROPERTIES_SASL_MECHANISM: SCRAM-SHA-512         KAFKA_CLUSTERS_0_PROPERTIES_SASL_JAAS_CONFIG: >            org.apache.kafka.common.security.scram.ScramLoginModule required            username=\"${KAFKA_USERNAME}\" password=\"${KAFKA_PASSWORD}\";\n         DYNAMIC_CONFIG_ENABLED: \"true\"\n         AUTH_TYPE: LOGIN_FORM         SPRING_SECURITY_USER_NAME: \"${KAFKA_UI_USER}\"         SPRING_SECURITY_USER_PASSWORD: \"${KAFKA_UI_PASSWORD}\"\n      healthcheck:         test: [\"CMD\", \"wget\", \"--no-verbose\", \"--tries=1\", \"--spider\", \"http://localhost:8080/actuator/health\"]         interval: 30s         timeout: 10s         retries: 3         start_period: 40s\n```\n4. Создайте файл .env:\n```\nnano .env\n```\n5. Вставьте содержимое файла:\n```\nKAFKA_BROKERS=<KAFKA_BROKER_IP>:9094KAFKA_USERNAME=<KAFKA_USERNAME>KAFKA_PASSWORD=<KAFKA_PASSWORD>KAFKA_UI_USER=<KAFKA_UI_USER>KAFKA_UI_PASSWORD=<KAFKA_UI_PASSWORD>\n```\n\nГде:\n- <KAFKA_BROKER_IP> — IP-адрес сервиса Managed Kafka®.\n- <KAFKA_USERNAME> — логин от кластера Managed Kafka® с ролью Admin.\n- <KAFKA_PASSWORD> — пароль от кластера Managed Kafka® с ролью Admin.\n- <KAFKA_UI_USER> — логин для доступа к сервису Kafbat UI.\n- <KAFKA_UI_PASSWORD> — пароль для доступа к сервису Kafbat UI.\nIP-адрес, логины и пароли можно найти на странице информации о кластере в блоке Данные для подключения.\n6. Запустите сервис:\n```\ndocker compose up -d\n```\n7. Перейдите по адресу https://kafkaui.<IP-адрес>.nip.io в браузере.\nОткроется страница Kafbat UI, и вы будете перенаправлены на страницу авторизации.\n8. Зайдите в приложение с логином и паролем, заданными в .env (KAFKA_UI_USER/KAFKA_UI_PASSWORD).\n\n## 5. Удалите доступ по SSH для виртуальной машины\nТак как для настроенного сервиса больше не требуется доступ по SSH, удалите доступ для повышения безопасности.\n1. В личном кабинете перейдите в сервис «Виртуальные машины» и выберите машину kafka-ui, созданную на первом шаге.\n2. Перейдите в раздел Сетевые параметры.\n3. Нажмите на Изменить группы безопасности для публичного IP-адреса.\n4. Удалите группу «SSH-access_ru».\n5. Нажмите Сохранить.\n6. Попробуйте подключиться к виртуальной машине по SSH по инструкции и убедитесь, что доступ отсутствует.\n\n## Результат\nВы развернули Kafbat UI на виртуальной машине Ubuntu 22.04, связали его с сервисом Managed Kafka® через виртуальную сеть VPC и подсети.\nВы получили опыт управления и мониторинга Kafka-кластера через удобный веб-интерфейс, включая просмотр топиков, групп потребителей и сообщений.\n\n  [© 2025 Cloud.ru](https://cloud.ru)",
      "debug": {
        "start_page": 1,
        "end_page": 1
      }
    }
  ]
}