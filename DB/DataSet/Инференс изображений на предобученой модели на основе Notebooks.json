{
  "title": "Инференс изображений на предобученой модели на основе Notebooks",
  "chapters": [
    {
      "name": "Инференс изображений на предобученой модели на основе Notebooks",
      "content": "Практические руководства Evolution    \n\n # Инференс изображений на предобученой модели на основе Notebooks   Эта статья полезна?          \nС помощью этого руководства вы проведете классификацию изображений с использованием предобученной модели ResNet18.\nВы создадите среду для работы с машинным обучением, загрузите и подготовите изображение, а также выполните инференс модели для получения топ-5 предсказаний.\nВы будете использовать следующие сервисы и библиотеки:\n\n- Notebooks — сервис для запуска сред ML и работы DS-специалистов в ноутбуках на платформе Evolution.\n- torchvision — позволяет использовать предобученные модели, такие как ResNet18, и предоставляет инструменты для преобразования и обработки изображений.\n- PIL — используется для работы с изображениями в формате PIL, включая их открытие, изменение размера и конвертацию.\n- requests — позволяет загружать изображения и другие данные с веб-ресурсов по URL.\n- BytesIO из модуля io — создает файлоподобный объект в памяти для работы с байтовыми данными, как с файлом, что удобно при обработке изображений из потока.\n- json и urllib.request — библиотеки для загрузки, обработки и сериализации данных, например, при работе с веб-API или метаданными.\n\nШаги:\n1. Подготовьте среду.\n2. Используйте предобученную модель для инференса.\n3. Подготовьте изображение и выведете топ-5 предсказаний.\n\n## Перед началом работы\n\nЗарегистрируйтесь в личном кабинете Cloud.ru.\nЕсли вы уже зарегистрированы, войдите под своей учетной записью.\n\n## 1. Подготовьте среду\n1. Создайте ноутбук на основе образа с поддержкой CUDA.\n2. Установите PyTorch и torchvision:\n```\npip install torchpip install torchvision\n```\n\nПодробнее об установке PyTorch на официальном сайте.\n3. Проверьте доступность GPU:\n```\nimport torch\n# Check GPU availabilitycuda_available = torch.cuda.is_available()print(f\"CUDA доступен: {cuda_available}\")\n# If GPU is available, display the number of GPUs and the GPU nameif cuda_available:    print(f\"Количество доступных GPU: {torch.cuda.device_count()}\")    print(f\"Название GPU: {torch.cuda.get_device_name(0)}\")    device = torch.device(\"cuda\")else:    print(\"Используется CPU\")    device = torch.device(\"cpu\")\n```\n4. Импортируйте библиотеки для работы:\n```\nfrom torchvision import models, transformsfrom PIL import Imageimport requestsfrom io import BytesIOimport jsonimport urllib.request\n```\n\n## 2. Используйте предобученную модель для инференса\nНа этом шаге вы будете использовать предобученную модель для инференса, то есть для классификации изображений.\nМы загрузим изображение из интернета и обработаем его с помощью модели ResNet18, которая уже обучена на большом наборе данных.\n1. Загрузите изображение из интернета:\n```\nurl = \"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSlSaRKDvkuC2_Qyfnt8jMDmZzphQbIrz-TSg&s\"response = requests.get(url)img = Image.open(BytesIO(response.content)).convert('RGB')\n```\n\nВ результате мы получим объект изображения в формате RGB, готовый для дальнейшей обработки и анализа моделью.\n2. Загрузите модель ResNet18 и переведите ее в режим инференса:\n```\nmodel = models.resnet18(pretrained=True)model = model.to(device)model.eval()\n```\n\nВ результате мы загрузили модель, перевели ее в режим инференса и переместили на выбранное устройство GPU, если оно доступно, или CPU.\nЭто необходимо для того, чтобы модель была готова к обработке изображений и выдавала предсказания.\n\n## 3. Подготовьте изображение и получите топ-5 предсказаний\n1. Выполните преобразование изображения для инференса:\n```\npreprocess = transforms.Compose([    transforms.Resize(256),    transforms.CenterCrop(224),    transforms.ToTensor()])\n```\n\nПеред тем как подавать изображение на вход модели, необходимо преобразовать его в нужный формат.\nВ данном случае мы применили три преобразования: изменение размера изображения до 256 пикселей, центрированный обрез до размера 224x224 пикселей и преобразование в tensor.\nЭто необходимо для того, чтобы изображение соответствовало требованиям модели и могло быть обработано корректно.\n2. Загрузите имена классов:\n```\nurl = \"https://raw.githubusercontent.com/pytorch/hub/master/imagenet_classes.txt\"urllib.request.urlretrieve(url, \"imagenet_classes.txt\")\nwith open(\"imagenet_classes.txt\") as f:    class_names = [line.strip() for line in f.readlines()]\n```\n\nВ результате мы загрузили файл с именами классов ImageNet, которые используются в предобученной модели ResNet18.\nЭто нужно для интерпретации результатов работы модели и понимания какие классы она может предсказывать.\n3. Подготовьте изображение и выведите топ-5 предсказаний:\n```\n# Preprocess the imageinput_tensor = preprocess(img).unsqueeze(0).to(device)\n# Perform inferencewith torch.no_grad():   output = model(input_tensor)\n# Apply softmax to get probabilitiesprobabilities = torch.nn.functional.softmax(output[0], dim=0)\n# Get the top-5 predictionstop5_prob, top5_idx = torch.topk(probabilities, 5)\n# Print the top-5 predictionsprint(\"Топ-5 предсказаний:\")for i in range(top5_prob.size(0)):   class_name = class_names[top5_idx[i]]   prob = top5_prob[i].item()   print(f\"{i+1}: {class_name} ({prob:.4f})\")\n```\n\nВ результате мы получили Топ-5 предсказаний:\n```\nТоп-5 предсказаний:1: tabby (0.5923)2: tiger cat (0.2160)3: Egyptian cat (0.1611)4: paper towel (0.0057)5: plastic bag (0.0037)\n```\n\n## Результат\nВ ходе практической работы вы подготовили среду для работы с предобученной моделью ResNet18, загрузили и подготовили изображение, а также выполнили инференс модели для получения топ-5 предсказаний.\nЭтот подход позволяет быстро и эффективно классифицировать изображения без необходимости обучения модели с нуля.\nВы можете экспериментировать с разными изображениями и настройками, чтобы лучше понять, как работает модель, и улучшить ее производительность для ваших задач.\n\n  [© 2025 Cloud.ru](https://cloud.ru)",
      "debug": {
        "start_page": 1,
        "end_page": 1
      }
    }
  ]
}