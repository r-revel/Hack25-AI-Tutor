{
  "title": "Разработка высоконагруженного приложения на сервере Bare Metal",
  "chapters": [
    {
      "name": "Разработка высоконагруженного приложения на сервере Bare Metal",
      "content": "Практические руководства Evolution    \n\n # Разработка высоконагруженного приложения на сервере Bare Metal   Эта статья полезна?          \nС помощью этого руководства вы развернете среду для разработки высоконагруженных приложений.\nВ отличие от виртуальных сред или локальных машин, Bare Metal обеспечивает:\n- Предельную производительность — прямой доступ к CPU, RAM, дискам сервера без расходов на гипервизор, что критично для задач с интенсивными вычислениями, например при обработке 100 000+ RPS.\n- Детерминированное поведение — идентичность версий приложения для разработки, тестирования и реализации.\nЭто исключает «эффект соседа» в облачной среде и гарантирует воспроизводимость результатов.\n- Экономическую эффективность — централизация ресурсов сервера позволяет заменить все локальные машины разработчиков одним мощным сервером.\n- Ускорение CI/CD — сборки и тесты выполняются быстрее благодаря отсутствию ограничений виртуализации.\nАктуально для компиляции приложений на C++ или запуска ML-моделей.\nВ сценарии разберем разработку приложения командой из 10 разработчиков на сервере, у которого:\n- настроена среда разработки VSCode Server;\n- установлены программы для проектирования инженерных систем Ansys и HFSS;\n- установлена утилита X2Go для запуска Ansys и HFSS;\n- в качестве графической среды используется XFCE.\nПримечание Все действия в сценарии выполняются для создания пользователя dev1.\nЧтобы добавить пользователей для остальных разработчиков, повторите действия.\nШаги:\n1. Разверните инфраструктуру.\n2. Настройте VSCode Server и системные лимиты.\n3. Подключите локальный VSCode к VSCode Server.\n4. Настройте UFW для доступа к сервисам только по SSH.\n5. Настройте X2Go Server для удаленного рабочего стола на Linux.\n6. Настройте X2Go на устройстве разработчика.\n\n## 1. Разверните инфраструктуру\n1. Арендуйте сервер Bare Metal с публичным IP-адресом.\n2. Подключитесь к серверу по SSH или через виртуальную консоль.\n3. Установите Docker.\n\n## 2. Настройте VSCode Server и системные лимиты\n1. Создайте изолированное окружение для каждого разработчика:\n```\nsudo useradd -m -s /bin/bash dev1  # Создание пользователяsudo passwd dev1                   # Установка пароляsudo usermod -aG docker dev1       # Добавление в группу docker\n```\n2. Настройте системные лимиты:\n1. Откройте конфигурационный файл на запись:\n```\nsudo nano /etc/security/limits.conf\n```\n2. Добавьте в конец файла код:\n```\ndev1 soft nproc 50000dev1 hard nproc 100000dev1 soft nofile 50000dev1 hard nofile 100000\n* soft core unlimited\n```\n\n \n Дополнительная настройка для GUI-приложений\n3. Нажмите сочетание клавиш Ctrl + O.\n\n## 3. Подключите локальный VSCode к VSCode Server\nЧтобы обеспечить безопасность работы с приложением,\n1. На устройстве разработчика создайте пару SSH-ключей:\n```\nssh-keygen -t ed25519\n```\n2. Скопируйте публичный ключ на сервер:\n```\nssh-copy-id dev1@<server_ip_address>\n```\n3. Установите расширение «Remote SSH» для VSCode.\n4. Добавьте сервер в файл .ssh/config:\n```\nHost dev-server-dev1  HostName <server_ip_address>  User dev1  IdentityFile ~/.ssh/id_ed25519\n```\n5. Подключитесь к серверу из VSCode:\n1. Нажмите сочетание клавиш Ctrl + Shift + P.\n2. В строке поиска введите Remote-SSH: Connect to Host.\n3. В списке выберите dev-server-dev1.\n\n## 4. Настройте UFW для доступа к сервисам только по SSH\nПри разработке сервисов важно обеспечить их недоступность извне.\nДля этого необходимо закрыть все сервисные порты с помощью UFW.\nВ этом случае приложения будут доступны только по SSH.\n1. Создайте новые правила UFW:\n```\n# Сброс всех правилsudo ufw --force reset# Запретить все входящие соединения по умолчаниюsudo ufw default deny incoming# Разрешить все исходящиеsudo ufw default allow outgoing# Разрешить SSH (порт 22)sudo ufw allow 22/tcp# Включить UFWsudo ufw enable\n```\n2. Проверьте статус UFW:\n```\nsudo ufw status verbose\n```\n\nРезультат\n```\nStatus: activeLogging: on (low)Default: deny (incoming), allow (outgoing), disabled (routed)New profiles: skipTo Action From-- ------ ----22/tcp ALLOW IN Anywhere\n```\n\n## 5. Настройте X2Go Server для удаленного рабочего стола на Linux\nДля работы с графическими приложениями (CAD/CAM/CAE) терминала недостаточно.\nX2Go позволяет:\n- запускать графические приложения через SSH;\n- работать с 3D-рендерингом и тяжелыми GUI;\n- использовать несколько параллельных сессий на одном сервере;\n- экономить трафик.\n1. Установите X2Go Server и XFCE на сервер:\n```\nsudo apt updatesudo apt install -y x2goserver x2goserver-xsessionsudo apt install -y xfce4 xfce4-goodies\n```\n2. Настройте пользователей:\n```\nsudo useradd -m -s /bin/bash engineer1sudo passwd engineer1\n```\n3. Создайте конфигурационный файл x2goagent.options в каталоге /etc/x2go/ и добавьте в него код:\n```\n# Разрешить аппаратное ускорениеUSE_XVFB = noENABLE_3D = yes# Оптимизация для CAD-приложенийNX_COMPRESSION = 9NX_IMAGE_CACHE = 50NX_SHM_DISABLE = no\n```\n4. Настройте лимиты для ресурсоемких задач:\n1. Откройте конфигурационный файл на запись:\n```\nsudo nano /etc/security/limits.conf\n```\n2. Добавьте в конец файла код:\n```\nengineer1 hard memlock unlimitedengineer1 soft memlock unlimitedengineer1 hard nofile 100000engineer1 soft nofile 50000engineer1 hard rtprio 99 # Для реального времени\n```\n5. Установите графические драйверы:\n```\nsudo apt install -y nvidia-driver-535-server nvidia-utils-535-server nvidia-fabricmanager-535sudo apt install linux-headers-5.15.0-94-genericsudo rebootsudo systemctl enable nvidia-fabricmanagersudo systemctl start nvidia-fabricmanagernvidia-sminvidia-smi nvlink -s\n```\n\n## 6. Настройте X2Go на устройстве разработчика\n1. Установите клиент:\nWindowsLinuxMacOS Скачайте клиент с официального сайта.\n2. Создайте подключение:\n- Host — публичный IP-адрес сервера.\n- Login — engineer1.\n- Session Type — XFCE.\n- Port — 22 (SSH).\n3. Укажите дополнительные настройки:\n```\n[Connection]# Аппаратное ускорениеuse_gfx=yesglx_cooler=yes # Для OpenGL[Media]# Для 3D-приложенийsound=bothprinting=no\n```\nСервер готов к работе над приложением.\n\n  [© 2025 Cloud.ru](https://cloud.ru)",
      "debug": {
        "start_page": 1,
        "end_page": 1
      }
    }
  ]
}