{
  "title": "Развертывание PostgreSQL на сервере Bare Metal",
  "chapters": [
    {
      "name": "Развертывание PostgreSQL на сервере Bare Metal",
      "content": "Практические руководства Evolution    \n\n # Развертывание PostgreSQL на сервере Bare Metal   Эта статья полезна?          \nС помощью этого руководства вы развернете СУБД PostgreSQL 15 на сервере Bare Metal с ОС Ubuntu 22.04.\nШаги:\n1. Разверните инфраструктуру.\n2. Установите и настройте PostgreSQL.\n3. Оптимизируйте настройки PostgreSQL.\n4. Оптимизируйте настройки файловой системы.\n\n## 1. Разверните инфраструктуру\n1. Арендуйте сервер Bare Metal с публичным IP-адресом.\nДля корректной работы модели выбирайте конфигурации с объемом оперативной памяти более 32 ГБ.\n2. Подключитесь к серверу по SSH или через виртуальную консоль.\n\n## 2. Установите и настройте PostgreSQL\n1. Установите PostgreSQL:\n```\nsudo apt updatesudo apt install postgresql\n```\n2. Переключитесь на профиль администратора PostgreSQL:\n```\nsudo su - postgres\n```\n3. Создайте базу данных и пользователя для нее:\n```\ncreatedb test_database \\createuser -P test_user \\psql -c \"GRANT ALL PRIVILEGES ON DATABASE test_database TO test_user;\"\n```\n4. Переключитесь на основного пользователя:\n```\nexit\n```\n\n## 3. Оптимизируйте настройки PostgreSQL\nPostgreSQL по умолчанию содержит набор параметров для более тонкой настройки ее работы.\nНапример, вы можете увеличить производительность СУБД.\n1. Откройте файл с конфигурацией СУБД:\n```\nsudo nano /etc/postgresql/<postrgesql_version>/main/postgresql.conf\n```\n2. Отредактируйте параметры в файле:\n```\n# 25% ОЗУshared_buffers = 16GB# 50-75% ОЗУeffective_cache_size = 48GB# 128MB–256 MBwork_mem = 256MB# 1-2 GBmaintenance_work_mem = 2GB# обычно достаточно 100–200max_connections = 150# для возможности репликацииwal_level = replica# для максимальной производительности# synchronous_commit = off# checkpoint_timeout = 30minmax_wal_size = 4GB\n```\n\nГде:\n- shared_buffers — определяет производительность СУБД. Увеличьте его до 25% от доступной оперативной памяти. Например, если у вас 64 ГБ ОЗУ, установите значение около 16 ГБ.\n- effective_cache_size — объем памяти, который резервируется под PostgreSQL в кэше ОС. Установите его на 50-75% от общей оперативной памяти.\n- work_mem — объем памяти, выделяемый для сортировки и хеширования операций. Увеличьте его до 128–256 МБ.\n- maintenance_work_mem — объем памяти для фоновых задач обслуживания, таких как «VACUUM» и «CREATE INDEX». Увеличьте его до 1-2 ГБ.\n- max_connections — лимит на соединения с СУБД. Устанавливайте исходя из предполагаемой нагрузки. Обычно достаточно 100–200 соединений.\n- wal_level — режим работы журнала предзаписи (WAL). Установите режим «replica», чтобы обеспечить возможность репликации БД в случае сбоя.\n- synchronous_commit — определяет, в какой момент транзакции считаются выполненными. Если вам важна максимальная производительность, установите значение «off». Однако это снизит надежность транзакций.\n- checkpoint_timeout — настраивает интервал между созданием контрольных точек восстановления. Для повышения производительности увеличьте этот интервал до 30 минут. Однако при сбое БД ее восстановление займет больше времени.\n- max_wal_size — управляет размером WAL-файлов. Увеличьте значение для больших рабочих нагрузок.\n\n## 4. Оптимизируйте настройки файловой системы\nВы также можете повысить производительность СУБД за счет оптимизации настроек файловой системы.\nДля этого добавьте дополнительные параметры в конфигурационный файл диска:\n- noatime — отключает запись времени доступа к файлу.\n- nodiratime — отключает обновление времени доступа для каталогов.\nНастройки снижают нагрузку на оперативную память.\nЧтобы их добавить:\n1. Откройте файл с конфигурацией диска:\n```\nsudo nano /etc/fstab\n```\n2. В строке с диском, на котором установлена СУБД, добавьте параметры «noatime» и «nodiratime»:\n```\n...# <device>                                <dir> <type> <options> <dump> <fsck>UUID=0a3407de-014b-458b-b5c1-848e******** /     ext4   defaults,noatime,nodiratime  0      1\n```\n\n  [© 2025 Cloud.ru](https://cloud.ru)",
      "debug": {
        "start_page": 1,
        "end_page": 1
      }
    }
  ]
}