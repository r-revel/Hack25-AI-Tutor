{
  "title": "Организация хранения файлов через Nextcloud с доступом через веб-интерфейс и мобильное приложение",
  "chapters": [
    {
      "name": "Организация хранения файлов через Nextcloud с доступом через веб-интерфейс и мобильное приложение",
      "content": "Практические руководства Evolution    \n\n # Организация хранения файлов через Nextcloud с доступом через веб-интерфейс и мобильное приложение   Эта статья полезна?          \nС помощью этого руководства вы развернете решение для работы с личными файлами на основе продукта Nextcloud.\nПосле развертывания продукта вы сможете работать с файлами через веб-интерфейс или с помощью приложений (Windows, MacOS X, Linux,  Android и iOS).\nВы будете использовать следующие сервисы:\n- Виртуальная машина free tier — сервис, в рамках которого предоставляется бесплатная виртуальная машина с готовой конфигурацией.\n- Публичный IP-адрес для доступа к веб-интерфейсу хранилища.\n- Object Storage — объектное S3-хранилище с бесплатным хранением файлов, объемом до 15 ГБ.\n- (Опционально) Бесплатный сервис nip.io для получения публичного доменного имени и сертификата.\nВы также можете использовать собственное зарегистрированное доменное имя и SSL-сертификат для организации доступа.\nШаги:\n1. Разверните ресурсы в облаке.\n2. Установите и настройте Nextcloud.\n3. Настройте доменное имя.\n4. Загрузите файлы в хранилище через Nextcloud.\n5. Проверьте отображение файлов в Object Storage.\n\n## Перед началом работы\n1. Зарегистрируйтесь в личном кабинете Cloud.ru.\nЕсли вы уже зарегистрированы, войдите под своей учетной записью.\n2. Получите ключи доступа Key ID и Key Secret.\n\n## 1. Разверните ресурсы в облаке\nНа этом шаге вы создадите бесплатную виртуальную машину и бакет в хранилище Object Storage.\n1. Создайте виртуальную машину со следующими параметрами:\n- Название — nextcloud-server.\n- Образ — на вкладке Публичные выберите образ с Ubuntu 22.04.\n- Публичный IP — оставьте Арендовать новый или выберите IP-адрес из списка арендованных.\n- Логин — оставьте значение по умолчанию или укажите новый.\n- Метод аутентификации — Публичный ключ и Пароль.\n- Пароль — задайте пароль пользователя.\n- Остальные параметры оставьте по умолчанию или выберите на свое усмотрение.\n2. Уточните зону доступности, в которой была создана виртуальная машина.\n3. Создайте группу безопасности с названием nextcloud-server в той же зоне доступности и добавьте в нее правила:\n Трафик Протокол Порт Тип источника/адресата Источник/Адресат ВходящийTCP443IP-адрес0.0.0.0/0ВходящийTCP80IP-адрес0.0.0.0/0Исходящий Любой—IP-адрес0.0.0.0/0\n4. Назначьте созданную группу безопасности виртуальной машине.\n5. Создайте бакет в сервисе Object Storage со следующими параметрами:\n- Название — название бакета в формате <name>-nextcloud-data, например ivan-nextcloud-data.\n- Доменное имя — название домена в формате <name>-nextcloud-data, например ivan-nextcloud-data.\n- Класс хранения по умолчанию — стандартный.\n- (Опционально) Максимальный размер — включите опцию и укажите максимальный размер бакета.\nПри выключенной опции размер бакета не будет ограничен.\n6. Проверьте создание ресурсов:\n1. Убедитесь, что в личном кабинете на странице Сети → Группы безопасности отображается группа безопасности nextcloud-server со статусом «Создана».\n2. Убедитесь, что в личном кабинете на странице Инфраструктура → Виртуальные машины отображается виртуальная машина nextcloud-server со статусом «Запущена».\nВиртуальной машине назначен публичный IP-адрес.\n3. Скопируйте и сохраните публичный IP-адрес, он понадобится далее.\n4. Убедитесь, что в личном кабинете на странице Хранение данных → Object Storage отображается бакет <name>-nextcloud-data.\n5. Скопируйте и сохраните ID тенанта, он понадобится далее.\n\n## 2.  Установите и настройте Nextcloud\nНа этом шаге вы установите и настроите Nextcloud на виртуальной машине, а также настроите хранение данных в Object Storage.\n1. Подключитесь к виртуальной машине через серийную консоль.\n2. Обновите систему и установите утилиты:\n```\nsudo apt update && sudo apt upgrade -y\n```\n3. Установите пакет Nextcloud:\n```\nsudo snap install nextcloud\n```\n4. Выделите объем памяти для Nextcloud:\n```\nsudo snap set nextcloud php.memory-limit=2048M\n```\n5. Включите компрессию HTTP:\n```\nsudo snap set nextcloud http.compression=true\n```\n6. Создайте пользователя — укажите <username> и <password>:\n```\nsudo nextcloud.manual-install <username> <password>\n```\n\nКогда установка закончится, в консоли отобразится сообщение «Nextcloud was sucessfully installed».\n7. Выполните построчно команды для настройки хранения данных в Object Storage:\n```\nsudo nextcloud.occ config:system:set objectstore class --value=\"\\\\OC\\\\Files\\\\ObjectStore\\\\S3\"\nsudo nextcloud.occ config:system:set objectstore arguments bucket --value=\"<bucket_name>\"\nsudo nextcloud.occ config:system:set objectstore arguments key --value=\"<tenant_id>:<key_id>\"\nsudo nextcloud.occ config:system:set objectstore arguments secret --value=\"<key_secret>\"\nsudo nextcloud.occ config:system:set objectstore arguments hostname --value=\"s3.cloud.ru\"\nsudo nextcloud.occ config:system:set objectstore arguments port --value=\"443\"\nsudo nextcloud.occ config:system:set objectstore arguments use_ssl --value=true\nsudo nextcloud.occ config:system:set objectstore arguments region --value=\"ru-central-1\"\n```\n\nГде:\n- <bucket_name> — название бакета, созданного на предыдущем шаге, в формате <name>-nextcloud-data.\n- <tenant_id> — идентификатор тенанта в Object Storage.\n- <key_id>, <key_secret> — ключи доступа.\n8. Проверьте корректность настройки:\n```\nsnap changes nextcloud\n```\n\nВ ответе вернется информация об установке Nextcloud и изменении его конфигурации.\n\n## 3. Настройте доменное имя\nНа этом шаге вы создадите доменное имя и поучите SSL-сертификат, используя сервис nip.io.\nВы также можете использовать собственный домен и SSL-сертификат.\n1. Подготовьте доменное имя вида <ip_address>.nip.io, где <ip_address> — публичный IP-адрес виртуальной машины nextcloud-server.\n2. Настройте доверенное доменное имя:\n```\nsudo nextcloud.occ config:system:set trusted_domains 1 --value=<ip_address>.nip.io\n```\n3. Настройте SSL-сертификат:\n1. Выполните команду:\n```\nsudo nextcloud.enable-https lets-encrypt\n```\n2. Нажмите y в ответ на вопрос «Have you met these requirements?».\n3. Укажите свой email.\n4. Укажите домен <ip_address>.nip.io, подготовленный ранее.\n\n## 4. Загрузите файлы в хранилище через Nextcloud\nДля проверки работы системы загрузите файл через браузер:\n1. Откройте браузер и перейдите по адресу <ip_address>.nip.io.\nОткроется страница авторизации Nextcloud.\n2. Авторизуйтесь в Nextcloud, используя username и password, которые вы задавали на шаге 2.\n3. Перейдите в раздел Все файлы и загрузите любой файл.\n4. Убедитесь, что файл появился в Nextcloud.\nДля работы с Nextcloud через мобильное устройство:\n1. Скачайте приложение Nextcloud.\n2. Нажмите Войти и укажите в адрес сервера <ip_address>.nip.io.\nВ приложении отобразится загруженный через веб-интерфейс файл.\n\n## 5. Проверьте отображение файлов в Object Storage\nПроверьте, что в качестве хранилища для файлов используется Object Storage.\n1. В личном кабинете на верхней панели слева нажмите  и выберите Хранение данных → Object Storage.\n2. Выберите бакет, созданный на шаге 1.\nВ бакете отображаются служебные и загруженные файлы.\nРеальные имена файлов при этом заменены на служебные.\n\n## Результат\nВы настроили и запустили собственный сервер для работы и обмена файлами на базе Nextcloud, а также проверили его работу в браузере и на мобильном устройстве.\nТеперь вы можете загружать и работать с файлами через браузер и мобильные приложения.\n\n  [© 2025 Cloud.ru](https://cloud.ru)",
      "debug": {
        "start_page": 1,
        "end_page": 1
      }
    }
  ]
}