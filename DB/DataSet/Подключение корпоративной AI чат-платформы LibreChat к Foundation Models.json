{
  "title": "Подключение корпоративной AI чат-платформы LibreChat к Foundation Models",
  "chapters": [
    {
      "name": "Подключение корпоративной AI чат-платформы LibreChat к Foundation Models",
      "content": "Практические руководства Evolution    \n\n # Подключение корпоративной AI чат-платформы LibreChat к Foundation Models   Эта статья полезна?          \nС помощью этого руководства вы развернете чат-платформу LibreChat на бесплатной виртуальной машине в облаке Cloud.ru Evolution.\nВы создадите виртуальную машину Ubuntu 22.04, назначите ей публичный IP-адрес, установите Docker и Docker Compose, запустите LibreChat и опубликуете сервис через Nginx с SSL-сертификатом, выпущенным в Let’s Encrypt.\nВ результате вы сконфигурируете LibreChat для работы с Foundation Models и получите сервис, готовый к работе.\nВы будете использовать следующие сервисы:\n- Foundation Models — сервис для доступа к API популярных фундаментальных моделей машинного обучения с открытым исходным кодом.\n- Виртуальные машины — сервис, в рамках которого предоставляется виртуальная машина.\n- Публичный IP-адрес.\n- Docker — система контейнеризации.\n- Docker Compose — инструмент для запуска и управления Docker-контейнерами.\n- Бесплатный сервис nip.io для получения публичного доменного имени и сертификата.\nВы также можете использовать собственное зарегистрированное доменное имя и SSL-сертификат для организации доступа.\n- Nginx — веб-сервер для проксирования запросов и организации защищeнного HTTPS-доступа к приложению.\n- Let’s Encrypt — сервис для автоматического получения бесплатного SSL-сертификата.\n- LibreChat —  бесплатная open-source-платформа, объединяющая в одном веб-интерфейсе различные языковые модели.\nШаги:\n1. Разверните необходимые ресурсы в облаке.\n2. Сгенерируйте API-ключ для доступа к Foundation Models.\n3. Настройте окружение на виртуальной машине.\n4. Настройте Nginx и HTTPS.\n5. Разверните приложение LibreChat.\n6. Отключите доступ по SSH для виртуальной машины.\n\n## Перед началом работы\n1. Зарегистрируйтесь в личном кабинете Cloud.ru.\nЕсли вы уже зарегистрированы, войдите под своей учетной записью.\n2. Сгенерируйте SSH-ключ.\n3. Загрузите публичную часть SSH-ключа в облако Cloud.ru Evolution.\n\n## 1. Разверните необходимые ресурсы в облаке\nНа этом шаге вы создадите группу безопасности и виртуальную машину.\n1. Создайте группу безопасности с названием ai-chat-service и добавьте в нее правила:\n- Правило входящего трафика 1:\n- Протокол: TCP\n- Порт: 443\n- Тип источника: IP-адрес\n- Источник: 0.0.0.0/0\n- Правило входящего трафика 2:\n- Протокол: TCP\n- Порт: 80\n- Тип источника: IP-адрес\n- Источник: 0.0.0.0/0\n- Правило исходящего трафика:\n- Протокол: Любой\n- Тип адресата: IP-адрес\n- Адресат: 0.0.0.0/0\nНа странице Сети → Группы безопасности убедитесь, что отображается группа безопасности ai-chat-service со статусом «Создана».\n2. Создайте бесплатную виртуальную машину со следующими параметрами:\n\n- Название: ai-chat-service\n- Образ: публичный образ Ubuntu 22.04\n- Подключить публичный IP: включено\n- Тип IP: прямой IP-адрес\n- Группы безопасности: SSH-access_ru.AZ-1, ai-chat-service\n- Логин: aichat\n- Метод аутентификации: Публичный ключ и Пароль\n- Публичный ключ: укажите ранее созданный ключ\n- Пароль: задайте надежный пароль\n- Имя хоста: ai-chat-service\n3. На странице Инфраструктура → Виртуальные машины убедитесь, что отображается виртуальная машина ai-chat-service со статусом «Запущена».\n\n## 2. Сгенерируйте API-ключ для доступа к Foundation Models\nСледуйте инструкции по созданию API-ключа для Foundation Models.\nСохраните API-ключ, он будет использоваться для конфигурации сервиса.\n1. На верхней панели слева нажмите  и перейдите в раздел Пользователи, на вкладку Сервисные аккаунты.\n2. Нажмите на название сервисного аккаунта, который будете использовать для отправки запроса к модели.\n3. Перейдите на вкладку API-ключи.\n4. Нажмите Создать API-ключ.\n5. Введите название и описание API-ключа, которое поможет в будущем идентифицировать его среди других ключей.\n6. Заполните параметры API-ключа:\n- Сервисы — Foundation Models.\n- Время действия — срок действия API-ключа и часовой пояс.\nВы можете установить значение от одного дня до одного года с текущей даты.\nЕсли параметр не задан, срок действия ключа устанавливается на максимальное значение — один год.\nС целью повышения уровня безопасности рекомендуется выставлять средние значения, например 90 дней.\n- Интервал работы ключа — один или несколько интервалов времени, в которые можно использовать API-ключ.\n7. Нажмите Создать.\n8. Сохраните Key Secret.\nПосле закрытия окна получить его будет нельзя.\nСозданный API-ключ появится в списке ключей в статусе «Активен».\nПодробнее о работе с API-ключом.\n\n## 3. Настройте окружение на виртуальной машине\nНа этом шаге вы установите необходимые пакеты и настроите систему на виртуальной машине.\n1. Подключитесь к виртуальной машине ai-chat-service через серийную консоль или по SSH.\n2. Обновите систему и установите необходимые зависимости:\n```\nsudo apt update && sudo apt upgrade -y &&\\sudo apt install -y curl apt-transport-https\\                         ca-certificates\\                         software-properties-common\\                         gnupg2\\                         lsb-release\n```\n3. Установите Docker:\n```\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpgecho \"deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/nullsudo apt updatesudo apt install docker-ce docker-ce-cli containerd.io -y\n```\n4. Дайте текущему пользователю права на запуск Docker:\n```\nsudo usermod -aG docker $USERnewgrp docker\n```\n5. Установите Docker Compose:\n```\nsudo apt-get install docker-compose-plugin -y\n```\n6. Проверьте, что Docker и Docker Compose установлены корректно:\n```\ndocker --versiondocker compose version\n```\n7. Установите Nginx сервер:\n```\nsudo apt install nginx -ysudo systemctl start nginxsudo systemctl enable nginx\n```\n8. Установите Let’s Encrypt и плагин для Nginx:\n```\nsudo apt install certbot python3-certbot-nginx -y\n```\n\n## 4. Настройте Nginx и HTTPS\nНа этом шаге вы настроите службу Nginx и обеспечите доступ по HTTPS.\n1. Подключитесь к виртуальной машине ai-chat-service через серийную консоль или по SSH.\n2. Настройте файервол:\n```\nsudo ufw allow OpenSSHsudo ufw allow 'Nginx Full'sudo ufw enable\n```\n3. Создайте конфигурационный файл:\n```\nsudo nano /etc/nginx/sites-available/librechat.conf\n```\n4. Вставьте конфигурацию, заменив <ip-address> на IP-адрес вашей виртуальной машины.\n```\nserver {   listen 80;   server_name chat.<ip-address>.nip.io www.chat.<ip-address>.nip.io;\n   location / {      proxy_pass http://localhost:3080;      proxy_set_header Host $host;      proxy_set_header X-Real-IP $remote_addr;      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;   }}\n```\n5. Примените конфигурацию и перезапустите Nginx:\n```\nsudo ln -sf /etc/nginx/sites-available/librechat.conf /etc/nginx/sites-enabled/librechat.confsudo rm -f /etc/nginx/sites-enabled/defaultsudo nginx -tsudo systemctl reload nginx\n```\n6. Проверьте, что Nginx работает:\n```\nsudo systemctl status nginx\n```\n\nCервис Nginx должен быть в статусе «active (running)».\n7. Перейдите по адресу http://chat.<ip-address>.nip.io.\nОткроется страница с текстом «502 Bad Gateway».\n8. Запустите команду для выпуска SSL-сертификата.\n```\nsudo certbot --nginx -d chat.<ip-address>.nip.io --redirect --agree-tos -m <email>\n```\n\nГде:\n- <ip-address> — IP-адрес вашей виртуальной машины.\n- <email> — email для регистрации сертификата.\n9. После выпуска сертификата перейдите по адресу https://chat.<ip-address>.nip.io.\nОткроется страница с текстом «502 Bad Gateway».\nВ свойствах сайта браузер отметит соединение как безопасное.\n\n## 5. Разверните приложение LibreChat\nРазверните серверное приложение LibreChat с помощью Docker Compose.\n1. Подключитесь к виртуальной машине ai-chat-service через серийную консоль или по SSH.\n2. Создайте структуру проекта:\n```\nmkdir -p $HOME/librechatcd $HOME/librechat\n```\n3. Сгенерируйте уникальные ключи и сохраните их, они понадобятся в дальнейшем:\n```\nopenssl rand -hex 32  # Save as JWT_SECRETopenssl rand -hex 32  # Save as JWT_REFRESH_SECRET\n```\n4. Создайте файл docker-compose.yml:\n```\nnano docker-compose.yml\n```\n5. Вставьте содержимое в файл docker-compose.yml:\n```\nservices:mongo:   image: mongo:6.0   restart: always   volumes:      - mongo-data:/data/db   ports:      - '27017:27017'\nlibrechat:   image: librechat/librechat:latest   depends_on:      - mongo   ports:      - '3080:3080'   env_file:      - ./.env   volumes:      - ./data:/app/data   restart: always\nvolumes:mongo-data:\n```\n6. Создайте файл конфигурации .env:\n```\nnano docker.env\n```\n7. Вставьте содержимое в файл, заменив переменные на значения:\n```\nNODE_ENV=productionMONGO_URI=mongodb://mongo:27017/librechat\nJWT_SECRET=<jwt_secret>JWT_REFRESH_SECRET=<jwt-refresh-secret>\nDOMAIN_CLIENT=https://chat.<ip-address>.nip.ioDOMAIN_SERVER=https://chat.<ip-address>.nip.io\nOPENAI_REVERSE_PROXY=https://foundation-models.api.cloud.ru/v1/OPENAI_API_KEY=<api-key>\n```\n\nГде:\n- <jwt-secret>, <jwt-refresh-secret> — секреты, сгенерированные ранее.\n- <ip-address> — публичный IP-адрес виртуальной машины.\n- <api-key> — ключ для доступа к сервису Foundation Models, сгенерированный на шаге 2.\n8. Запустите сервис:\n```\ndocker-compose up -d\n```\n9. Проверьте, что сервис запущен:\n```\ndocker compose ps\n```\n10. Сгенерируйте пользователя с правами администратора:\n```\nsudo docker exec -it librechat_librechat_1 \\   npm run create-user <email> yourname --email-verified=true\n```\n\nГде <email> — email-адрес пользователя.\nВо время выполнения команды задайте логин и пароль для нового пользователя.\n11. Перейдите по адресу https://chat.<ip-адрес>.nip.io.\nОткроется страница LibreChat.\n12. Авторизуйтесь в LibreChat, используя пароль пользователя с правами администратора.\n13. В интерфейсе чата выберите Агенты -> OpenAI и выберите модель для работы в чате.\n14. Введите ваш запрос в чат и получите ответ от LLM-модели Foundation Models.\n\n## 6. Отключите доступ по SSH для виртуальной машины\nДля повышения безопасности закройте доступ по SSH, после того как вы развернули и настроили сервис.\n1. В личном кабинете Cloud.ru на верхней панели слева нажмите  и выберите Инфраструктура → Виртуальные машины.\n2. В списке виртуальных машин выберите ai-chat-service.\n3. Перейдите на вкладку Сетевые параметры.\n4. В строке подсети нажмите  и выберите Изменить группы безопасности.\n5. Удалите группу SSH-access_ru и сохраните изменения.\n6. Убедитесь, что доступа нет — попробуйте подключиться к виртуальной машине по SSH.\nПосле отключения доступа по SSH, администрирование сервиса будет доступно через серийную консоль виртуальной машины.\n\n## Результат\nВ этой лабораторной работе вы развернули чат-сервис для работы в облаке Cloud.ru с сетевой изоляцией и публикацией по HTTPS.\nПолученные навыки помогут вам создавать AI-сервисы с использованием сервисов Foundation Models.\nДля командной работы сконфигурируйте требуемый провайдер авторизации.\n\n  [© 2025 Cloud.ru](https://cloud.ru)",
      "debug": {
        "start_page": 1,
        "end_page": 1
      }
    }
  ]
}