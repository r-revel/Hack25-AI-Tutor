{
  "title": "Построение отчета с PostgreSQL",
  "chapters": [
    {
      "name": "Построение отчета с PostgreSQL",
      "content": "Практические руководства Evolution    \n\n # Построение отчета с PostgreSQL   Эта статья полезна?          \nВ этом руководстве описано создание отчетов Superset на основе данных из Managed PostgreSQL с помощью Managed Trino.\n\n## Постановка задачи\nСоздать две столбчатые диаграммы на основе данных клиентов.\nОтчеты должны отражать распределение мужчин и женщин в выборке, а также их средний возраст.\n\n## Перед началом работы\nЗарегистрируйтесь в личном кабинете Cloud.ru.\nЕсли вы уже зарегистрированы, войдите под своей учетной записью.\nПосле входа выполните шаги, необходимые для работы BI:\n1. Создайте публичный SNAT-шлюз, чтобы обеспечить связь инстанса с S3.\n2. Настройте DNS-сервер и подсеть.\n3. Создайте кластер Data Platform, в котором будет размещен инстанс.\n4. Скачайте и установите root-сертификат на устройство.\n5. Создайте группу безопасности для инстанса Managed BI.\nВ ней создайте разрешающие правила на входящий и исходящий трафик.\n6. Создайте кластер PostgreSQL, в котором будут храниться данные для визуализации.\n7. Создайте кластер Data Platform dp-labs.\n8. Скачайте и установите root-сертификат на устройство.\n9. Установите JDBC-клиент DBeaver для подключения к BI.\n\n## Подготовьте данные\nВ этом сценарии Superset будет использовать Managed PostgreSQL® как источник данных.\nНеобходимо загрузить таблицу в базу данных и подключить Managed Trino к ней.\n\n### Создайте кластер PostgreSQL\n1. Перейдите в раздел Evolution и выберите сервис Managed PostgreSQL®, в правом верхнем углу нажмите Создать кластер.\n2. Создайте кластер, следуя шагам, описанным в документации Managed PostgreSQL®.\nЗадайте название DBaaS-PG-1.\n3. Дождитесь, когда статус кластера изменится на «Доступен».\n4. Откройте карточку кластера PostgreSQL®.\nИнформация понадобится на следующих этапах.\n\n### Подготовьте Managed Trino\nСоздайте подключение\n1. Перейдите в раздел Evolution и выберите сервис Managed Trino.\n2. Нажмите Создать и выберите Подключение.\n3. Заполните поля следующими значениями:\n- Название — postgres.\n- Коннектор — PostgreSQL.\n- Хост — внутренний IP, указанный в карточке кластера DBaaS-PG-1.\n- Порт — порт, указанный в карточке кластера DBaaS-PG-1.\n- Название базы данных — dbaas_pg_1.\n- Логин — логин, указанный в карточке кластера DBaaS-PG-1.\n- Пароль — пароль кластера, сохраненный в Secret Management.\nЕсли нужного секрета нет, создайте новый, нажав Создать новый секрет.\n4. Нажмите Создать.\nСоздайте инстанс Trino\n1. Перейдите в раздел Evolution и выберите сервис Managed Trino.\n2. Нажмите Создать и выберите Инстанс Trino.\n3. В блоке Общие параметры заполните поля:\n- Название — trino-instance.\n- Вычислительные ресурсы — Small (vCPU 4, RAM 16).\n- Количество нод — 3.\n- Подключение — выберите подключение «postgres».\n4. Нажмите Продолжить.\n5. В блоке Сетевые настройки заполните поля:\n- VPC — выберите сеть VPC.\n- Зона доступности — выберите зону доступности, для которой создан SNAT-шлюз.\n- Подсеть — выберите подсеть с DNS-сервером, в которой располагается кластер PostgreSQL®.\n- Группа безопасности — выберите группу безопасности.\n- Подключить публичный хост — активируйте переключатель.\n- Пользователь — введите имя пользователя.\n- Пароль — выберите секретный ключ.\n6. Нажмите Создать.\n7. Дождитесь, когда статус инстанса изменится на «Готов».\n8. Откройте карточку инстанса BI.\nИнформация из него понадобится на следующих этапах.\nПодключитесь к Trino с помощью DBeaver\nВыполните шаги, описанные на странице Подключить инстанс к клиенту JDBC.\n\n### Загрузите данные в PostgreSQL\n1. Скачайте таблицу mall_customers.csv.\n2. В DBeaver вставьте SQL-запрос:\n```\nCREATE TABLE <catalog.schema.table_name> (   customerid integer,   genre varchar(50),   age integer,   annualincome integer,   spendingscore integer);\n```\n3. В списке баз данных нажмите правой кнопкой мыши на созданной таблице.\n4. В контекстном меню выберите Импорт данных.\n5. Выберите формат .csv.\n6. Выберите ранее скаченную таблицу mall_customers.\n7. Оставьте последующие настройки по умолчанию.\n8. Нажмите Далее, затем Применить.\n\n## Подготовьте Superset\nНеобходимо развернуть инстанс Superset, подключить его к Managed PostgreSQL® через коннектор Trino.\n\n### Создайте инстанс Managed BI\n1. Перейдите в раздел Evolution и выберите сервис Managed BI.\n2. Нажмите Создать инстанс.\n3. В блоке Конфигурация выберите:\n- Вычислительные ресурсы — Small (vCPU 2, RAM 4).\n4. Нажмите Продолжить.\n5. В блоке Сетевые настройки выберите:\n- Подсеть — выберите подсеть с DNS-сервером.\n- Группа безопасности — выберите созданную безопасности.\n6. Нажмите Создать.\nСоздание инстанса занимает 15 минут.\nДождитесь, когда статус изменится на «Готов».\n\n### Откройте Superset\n1. На странице Managed BI нажмите на карточку инстанса.\n2. Нажмите SIGN IN WITH CLOUD.\n3. Введите данные своей учетной записи.\n\n### Создайте подключение в Superset\n1. Откройте Superset.\n2. В правом верхнем углу нажмите Settings и выберите Database Connections.\n3. Нажмите Database +.\n4. В поле Supported Databases выберите Trino с помощью поиска.\n5. В поле SQLAlchemy URI введите данные инстанса Trino в формате trino://<username>:<password>@<host>:<port>, где:\n- <username> — имя пользователя, поле Пользователь в карточке инстанса Trino.\n- <password> — пароль, поле Пароль в карточке инстанса Trino.\n- <host> — хост из карточки инстанса Trino.\n- <port> — порт из карточки инстанса Trino.\n6. Нажмите Connect.\nПодключение появится в списке «Databases».\n\n### Создайте датасет\n1. В Superset перейдите на вкладку Датасеты.\n2. В правом верхнем углу нажмите Dataset +.\n3. Заполните поля:\n- Database — Trino\n- Schema — Lab\n- Table — mall_customers\n4. Нажмите Create dataset snd create chart.\n\n## Создайте отчет с отражением пола клиентов\n1. В Superset перейдите на вкладку Графики.\n2. В разделе Choose a dataset выберите «mall_customers».\n3. В разделе Choose chart type выберите Bar chart.\n4. В правом нижнем углу нажмите Create new chart.\n5. Заполните поля:\n- X-AXIS — gender\n- METRICS — age\nУсловие агрегирования «Count».\n6. В правом верхнем углу нажмите Save.\n\n## Создайте отчет с отражением среднего возраста и пола клиентов\n1. В Superset перейдите на вкладку Графики.\n2. В разделе Choose a dataset выберите «mall_customers».\n3. В разделе Choose chart type выберите Bar chart.\n4. В правом нижнем углу нажмите Create new chart.\n5. Заполните поля:\n- X-AXIS — gender\n- METRICS — age\nУсловие агрегирования «Average»\n6. В правом верхнем углу нажмите Save.\n\n### Создайте дашборд\n1. В Superset перейдите на вкладку Дашборды.\n2. В правом нижнем углу нажмите Dashborad +.\n3. Из списка справа перетащите ранее созданные графики в рабочую область с левой стороны.\n4. Нажмите Save.\n\n## Результат\nВы научились работать с источником данных, подключать его к Superset и визуализировать полученные из источника данные.\n\n  [© 2025 Cloud.ru](https://cloud.ru)",
      "debug": {
        "start_page": 1,
        "end_page": 1
      }
    }
  ]
}