{
  "title": "Запуск контейнеризированного приложения на виртуальной машине с помощью Docker и Docker Compose",
  "chapters": [
    {
      "name": "Запуск контейнеризированного приложения на виртуальной машине с помощью Docker и Docker Compose",
      "content": "Практические руководства Evolution    \n\n # Запуск контейнеризированного приложения на виртуальной машине с помощью Docker и Docker Compose   Эта статья полезна?          \nС помощью этого руководства вы соберете контейнерное приложение и запустите его на виртуальной машине.\nВы будете использовать следующие сервисы:\n- Виртуальная машина free tier — сервис, в рамках которого предоставляется бесплатная виртуальная машина с готовой конфигурацией.\n- Публичный IP-адрес для доступа к приложению из интернета.\n- Docker — система контейнеризации.\n- Docker Compose — инструмент для запуска и управления Docker-контейнерами.\nШаги:\n1. Создайте виртуальную машину.\n2. Настройте группу безопасности.\n3. Установите Docker Engine.\n4. Создайте и запустите контейнер с помощью средств Docker.\n5. Создайте приложение с помощью Docker Compose.\n\n## Перед началом работы\nЗарегистрируйтесь в личном кабинете Cloud.ru.\nЕсли вы уже зарегистрированы, войдите под своей учетной записью.\n\n## 1. Создайте виртуальную машину\n1. Сгенерируйте ключевую пару.\n2. Загрузите публичный ключ в облако.\n3. Создайте бесплатную виртуальную машину со следующими параметрами:\n1. В поле Название укажите название виртуальной машины, например docker-server.\n2. На вкладке Публичные выберите образ Ubuntu 22.04.\n3. Назначьте публичный IP-адрес виртуальной машине — оставьте включенной опцию Подключить публичный IP. Для виртуальной машины будет арендован и назначен прямой публичный IP.\n4. В поле Логин укажите логин пользователя виртуальной машины, например user1.\n5. Выберите метод аутентификации — публичный ключ.\n6. В поле Публичный ключ выберите ключ, загруженный на предыдущем шаге.\nУбедитесь, что в личном кабинете на странице сервиса «Виртуальные машины»:\n- отображается виртуальная машина docker-server;\n- статус виртуальной машины — «Запущена»;\n- виртуальной машине назначен публичный IP-адрес.\n\n## 2. Настройте группу безопасности\nГруппы безопасности в облаке Evolution позволяют контролировать входящий и исходящий трафик для создаваемых ресурсов.\nВы настроите правила фильтрации трафика — разрешите весь входящий трафик по порту 80 и весь исходящий трафик.\nСоздайте новую группу безопасности со следующими параметрами:\n1. Выберите Зону доступности, в которой необходимо разместить группу безопасности. Укажите ту же зону доступности, что выбрана для виртуальной машины docker-server.\n2. Укажите Название группы безопасности, например docker-server.\n3. Добавьте правила входящего и исходящего трафика.\nПравило входящего трафика:\n- Протокол — TCP.\n- Порт — 80.\n- Тип источника — IP-адрес.\n- Источник — 0.0.0.0/0.\nПравило исходящего трафика:\n- Протокол — Любой.\n- Порт — оставьте пустым.\n- Тип адресата — IP-адрес.\n- Адресат — 0.0.0.0/0.\n4. Назначьте созданную группу безопасности виртуальной машине docker-server.\nЕсли в группе безопасности присутствуют другие виртуальные машины, исключите их из группы.\nУбедитесь, что в личном кабинете на странице сервиса «Виртуальные машины» в разделе Сетевые параметры отображается группа безопасности.\n\n## 3. Установите Docker Engine\n1. Подключитесь к виртуальной машине по SSH.\n2. В командной строке выполните команду:\n```\ncurl -fsSL get.docker.com -o get-docker.sh && sudo sh get-docker.sh\n```\n\n## 4. Создайте и запустите контейнер с помощью средств Docker\n1. Создайте директорию containerapp и перейдите в нее.\nВ командной строке выполните команду:\n```\nmkdir containerapp && cd containerapp\n```\n2. Создайте файл Dockerfile:\n```\nsudo nano Dockerfile\n```\n3. В открывшемся редакторе nano вставьте текст:\n```\nFROM tiangolo/uwsgi-nginx-flask:python3.12COPY ./app /app\n```\n4. Нажмите комбинацию клавиш Ctrl + O, чтобы сохранить файл.\n5. Нажмите комбинацию клавиш Ctrl + X, чтобы выйти из редактора nano.\n6. Создайте директорию для приложения app и перейдите в нее:\n```\nmkdir app && cd app\n```\n7. Создайте python-файл приложения:\n```\nsudo nano main.py\n```\n8. В открывшемся окне редактора вставьте код:\n```\nfrom flask import Flaskapp = Flask(__name__)@app.route(\"/\")def hello():   return \"Hello World from Flask\"if __name__ == \"__main__\":   app.run(host='0.0.0.0', debug=True, port=80)\n```\n9. Вернитесь на уровень выше — в директорию containerapp:\n```\ncd ..\n```\n10. Соберите образ контейнера:\n```\nsudo docker build -t containerapp .\n```\n11. После того как сборка образа закончится, запустите контейнер на виртуальной машине:\n```\nsudo docker run -d --name containerapp -p 80:80 containerapp\n```\n12. Убедитесь, что созданный мини-сайт доступен по публичному адресу виртуальной машины.\nВ браузере перейдите по адресу http://<публичный_IP_виртуальной_машины> — откроется страница с текстом «Hello World from Flask».\n\n## 5. Создайте приложение с помощью Docker Compose\n1. Остановите и удалите контейнер Docker.\nВ командной строке выполните команду:\n```\nsudo docker rm -f containerapp\n```\n2. Установите docker-compose:\n```\nsudo apt install docker-compose\n```\n3. Создайте файл docker-compose в директории containerapp:\n```\nsudo nano docker-compose.yaml\n```\n4. Вставьте в созданный файл описание создаваемого контейнера:\n```\nversion: '3.8'services:   flask-app:      image: tiangolo/uwsgi-nginx-flask:python3.12      ports:         - \"80:80\"      volumes:         - ./app/main.py:/app/main.py\n```\n5. Запустите контейнер с помощью docker-compose:\n```\nsudo docker-compose up -d flask-app\n```\n6. Убедитесь, что приложение успешно запущено, — в браузере перейдите по адресу http://<публичный_IP_виртуальной_машины>.\nЕсли все предыдущие шаги были выполнены корректно, на странице браузера отобразится следующий текст:\n\n## Результат\nВы создали виртуальную машину и запустили контейнерное приложение с помощью Docker и Docker Compose.\n\n  [© 2025 Cloud.ru](https://cloud.ru)",
      "debug": {
        "start_page": 1,
        "end_page": 1
      }
    }
  ]
}