{
  "title": "Подключение ИИ из Foundation Models к nocode Telegram-боту на основе Container Apps или Notebooks",
  "chapters": [
    {
      "name": "Подключение ИИ из Foundation Models к nocode Telegram-боту на основе Container Apps или Notebooks",
      "content": "Практические руководства Evolution    \n\n # Подключение ИИ из Foundation Models к nocode Telegram-боту на основе Container Apps или Notebooks   Эта статья полезна?          \nС помощью этого руководства вы запустите приложение n8n в Container Apps или в Notebooks.\nНа базе этого приложения создадите Telegram-бота, который будет интегрирован с сервисом Foundation Models.\nС помощью Foundation Models вы сможете отправлять запросы в различные AI-модели и обрабатывать пользовательские запросы.\nВ рамках этого сценария мы будем оценивать эмоциональный окрас сообщения пользователя.\nВы будете использовать следующие сервисы:\n- Artifact Registry для хранения, совместного использования и управления Docker-образами и Helm-чартами.\n- Container Apps — сервис для запуска контейнерных приложений в облаке. Не требует знания Kubernetes и создания виртуальных машин.\n- Notebooks — сервис для запуска сред ML и работы DS-специалистов в ноутбуках на платформе Evolution.\n- Object Storage — объектное S3-хранилище с бесплатным хранением файлов, объемом до 15 ГБ.\nБудет использоваться в качестве хранилища для контейнера.\n- Foundation Models — сервис для доступа к API популярных фундаментальных моделей машинного обучения с открытым исходным кодом.\n- n8n — платформа с открытым кодом для автоматизации рабочих процессов и интеграции сервисов. Подходит для экспериментов и пет-проектов.\nШаги:\n1. Подготовьте среду.\n2. Создайте Telegram-бота с помощью n8n и Container Apps.\n3. Удалите шаг отправки сообщения пользователю.\n4. Добавьте и настройте клиент OpenAI для подключения к Foundation Models.\n5. Отправьте ответ модели в Telegram-бот.\n6. Проверьте работу бота.\n\n## Перед началом работы\nЗарегистрируйтесь в личном кабинете Cloud.ru.\nЕсли вы уже зарегистрированы, войдите под своей учетной записью.\n\n## 1. Подготовьте среду\n1. Подготовьте среду, если не сделали этого ранее.\n2. Убедитесь, что у вас есть доступ к Foundation Models.\n3. Убедитесь, что баланс в личном кабинете положительный.\nЕсли он нулевой или отрицательный — пополните баланс.\nНебольшое количество запросов в Foundation Models будет стоить не больше рубля, подробнее — .\n4. Создайте сервисный аккаунт и API-ключ для аутентификации в API Foundation Models.\n\n## 2. Создайте Telegram-бота с помощью n8n и Container Apps\nВыполните сценарий, описанный в практическом руководстве Создание Telegram-бота без написания кода с помощью n8n и Container Apps или Notebooks.\nВнимание Тестовый образ n8n создан в версии n8n@1.116.2.\nЕсли вы создаете и разворачиваете кастомный образ, Рекомендуется использовать версию n8n 1.116.2 для стабильной работы образа с Container Apps и Foundation Models.\n\n## 3. Удалите шаг отправки сообщения пользователю\nБот будет отправлять ответ от LLM-модели.\nПоэтому отправка ботом пользователю его же сообщения больше не нужна.\nУдалите последний шаг SEND A TEXT MESSAGE в созданном рабочем процессе.\n\n## 4. Добавьте и настройте клиент OpenAI для подключения к Foundation Models\n1. Справа от действия Send a chat action нажмите +.\n2. На вкладке справа в поле поиска введите openai и выберите OpenAI в результатах поиска.\n3. В списке выберите Message a model.\n4. В окне свойств действия нажмите иконку карандаша рядом с полем Credential to connect with.\n5. В поле API Key введите API-ключ, полученный на этапе подготовки среды.\n6. В поле Organization ID (optional) введите идентификатор вашего проекта.\n7. В поле Base URL введите https://foundation-models.api.cloud.ru/v1.\n8. Нажмите Save и закройте окно учетных данных OpenAI.\n9. В окне свойств действия раскройте выпадающий список Model, выберите By ID и введите название модели openai/gpt-oss-120b.\n10. В секции Messages в поле Prompt введите:\n```\n{{ $('Telegram Trigger').item.json.message.text }}\n```\n11. Нажмите Add Message.\n12. В выпадающем списке Role выберите System.\n13. В поле Prompt для добавленного сообщения вставьте:\n```\nYou are an expert in text sentiment analysis. When solving a task, FIRST think step-by-step in private to reach your answer. Do NOT reveal these private thoughts. Instead, output ONLY a JSON object with three keys: 1. \"result\" – one of: \"positive\", \"negative\", \"neutral\" 2. \"confidence\" – number between 0 and 1 (e.g. 0.87). Calibrate it so the three classes are equally likely a priori. 3. \"explanation\" – a brief, public rationale (1-3 sentences) that cites the pivotal phrases.Use Russian language to provide explanation. Follow the format of the few-shot examples exactly: nothing before or after the JSON. Don't use json\n```\n\nПримечаниеС помощью промта модель анализирует эмоциональный окрас сообщения и возвращает ответ в формате JSON.\nОн содержит три поля:- result — результат оценки эмоционального окраса сообщения: негативный, нейтральный или позитивный;\n- confidence — уверенность в оценке от 0 до 1;\n- explanation — объяснение оценки.\n14. Включите опцию Output Content as JSON.\n15. Сверху нажмите Test step.\n16. Нажмите Back to canvas.\n\n## 5. Отправьте ответ модели в Telegram-бот\nДобавьте новое действие для стартового триггера Telegram:\n1. Справа от действия, добавленного на шаге 4, нажмите +.\n2. На вкладке справа в поле поиска введите telegram и выберите Telegram.\n3. В списке выберите Send a text message.\n4. В окне свойств действия измените наименование действия на Отправляем ответ.\n5. В поле Chat ID вставьте:\n```\n{{ $('Telegram Trigger').item.json.message.chat.id }}\n```\n6. В поле Text вставьте:\n```\nЭмоциональный окрас сообщения --- {{ $json.message.content.result }}Объяснение решения --- {{ $json.message.content.explanation }}\n```\n7. Нажмите Add Field и выберите Reply To Message ID.\n8. Слева найдите раздел Telegram Trigger и перетащите оттуда параметр message | message_id в поле добавленного параметра Reply To Message ID.\n9. Нажмите Test step.\nСправа вы увидите тело отправленного сообщения, а в Telegram-бот должно прийти тестовое сообщение с ответом.\n10. Нажмите Back to canvas.\n\n## 6. Проверьте работу бота\n1. Сверху проверьте, что переключатель находится в состоянии Active.\n2. Перейдите в Telegram-бот и отправьте любой вопрос.\nДолжен вернуться ответ от подключенной LLM.\n\n## Результат\nВы создали Telegram-бота в Container Apps или Notebooks, который интегрирован с сервисом Foundation Models и может отправлять запросы в различные AI-модели.\nРешение можно использовать для автоматического уведомления о новых комментариях на сайте и об их эмоциональном окрасе.\n\n  [© 2025 Cloud.ru](https://cloud.ru)",
      "debug": {
        "start_page": 1,
        "end_page": 1
      }
    }
  ]
}