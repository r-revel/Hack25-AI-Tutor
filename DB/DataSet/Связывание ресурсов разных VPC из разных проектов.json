{
  "title": "Связывание ресурсов разных VPC из разных проектов",
  "chapters": [
    {
      "name": "Связывание ресурсов разных VPC из разных проектов",
      "content": "Практические руководства Evolution    \n\n # Связывание ресурсов разных VPC из разных проектов   Эта статья полезна?          \nС помощью этого руководства вы создадите связность между виртуальными машинами из разных VPC, принадлежащих разным проектам.\nВы будете использовать соединения, маршруты и правила групп безопасности для связи ресурсов.\nСхема иллюстрирует результат по итогам выполнения шагов руководства:\n\nВы будете использовать следующие сервисы:\n- Виртуальные машины — сервис, в рамках которого предоставляется виртуальная машина.\n- VPC — изолированная виртуальная сеть для создания безопасной инфраструктуры.\n- Подсети — часть облачной сети, которая изолирована от других подобных сетей.\n- Magic Router — сервис для управления сетевыми связями между ресурсами внутри облачной инфраструктуры.\n- Группы безопасности — сервис для контроля трафика виртуальных машин.\nШаги:\n1. Подготовьте среду.\n2. Создайте соединение между VPC и Magic Router.\n3. Создайте соединение Magic Link.\n4. Настройте маршруты на Magic Router.\n5. Настройте маршруты для VPC.\n6. Настройте правила групп безопасности.\n7. Проверьте сетевую связность.\n\n## Перед началом работы\n1. Зарегистрируйтесь в личном кабинете Cloud.ru.\nЕсли вы уже зарегистрированы, войдите под своей учетной записью.\n2. Создайте и загрузите SSH-ключ в облако.\n\n## 1. Подготовьте среду\n1. Создайте две VPC-сети:\n1. В проекте 1 VPC-1.\n2. В проекте 2 VPC-2.\n2. Создайте три подсети — две в VPC-1 и одну в VPC-2:\n1. Подсеть subnet-1 в VPC-1 в зоне доступности ru.AZ-1:\n- Название: subnet-1.\n- VPC: VPC-1.\n- Зона доступности: ru.AZ-1.\n- Адрес: 10.1.1.0/24.\n2. Подсеть subnet-2 в VPC-1 в зоне доступности ru.AZ-2:\n- Название: subnet-2.\n- VPC: VPC-1.\n- Зона доступности: ru.AZ-2.\n- Адрес: 10.3.3.0/24.\n3. Подсеть subnet-3 в VPC-2 в зоне доступности ru.AZ-1:\n- Название: subnet-3.\n- VPC: VPC-2.\n- Зона доступности: ru.AZ-1.\n- Адрес: 10.2.2.0/24.\nУбедитесь, что:\n\n- В проекте 1 → Сеть → VPC для VPC-1 подсети subnet-1, subnet-2 отображаются в статусе «Создана».\n- В проекте 2 → Сеть → VPC для VPC-2 подсеть subnet-3 отображается в статусе «Создана».\n3. Создайте три ВМ — две в VPC-1 и одну в VPC-2:\n1. vm-1 в VPC-1 и подсети subnet-1:\n- Название: vm-1.\n- Зона доступности: ru.AZ-1.\n- Образ: Публичные → Ubuntu 22.04.\n- Гарантированная доля vCPU: 10%.\n- vCPU: 1.\n- RAM: 1.\n- VPC: VPC-1.\n- Подсеть: 10.1.1.0/24 (subnet-1).\n- Внутренний IP: Автоматически.\n- Группы безопасности: SSH-access_ru.AZ-1.\n- Метод аутентификации: Публичный ключ и пароль.\n- Публичный ключ: ваш SSH-ключ.\n- Пароль: ваш пароль.\n- Имя хоста: vm-1.\n2. vm-2 в VPC-1 и подсети subnet-2:\n- Название: vm-2.\n- Зона доступности: ru.AZ-2.\n- Образ: Публичные → Ubuntu 22.04.\n- Гарантированная доля vCPU: 10%.\n- vCPU: 1.\n- RAM: 1.\n- VPC: VPC-1.\n- Подсеть: 10.3.3.0/24 (subnet-2).\n- Внутренний IP: Автоматически.\n- Группы безопасности: SSH-access_ru.AZ-2.\n- Метод аутентификации: Публичный ключ и пароль.\n- Публичный ключ: ваш SSH-ключ.\n- Пароль: ваш пароль.\n- Имя хоста: vm-2.\n3. vm-3 в VPC-2 и подсети subnet-3:\n- Название: vm-3.\n- Зона доступности: ru.AZ-1.\n- Образ: Публичные → Ubuntu 22.04.\n- Гарантированная доля vCPU: 10%.\n- vCPU: 1.\n- RAM: 1.\n- VPC: VPC-2.\n- Подсеть: 10.2.2.0/24 (subnet-3).\n- Внутренний IP: Автоматически.\n- Группы безопасности: SSH-access_ru.AZ-1.\n- Метод аутентификации: Публичный ключ и пароль.\n- Публичный ключ: ваш SSH-ключ.\n- Пароль: ваш пароль.\n- Имя хоста: vm-3.\nУбедитесь, что:\n- В проекте 1 → Инфраструктура → Виртуальные машины виртуальные машины vm-1 и vm-2 отображаются в статусе «Запущена».\n- В проекте 2 → Инфраструктура → Виртуальные машины виртуальная машина vm-3 отображается в статусе «Запущена»\n\n## 2. Создайте соединения между VPC и Magic Router\nСоздайте Magic Router в каждом из проектов и создайте соединения между VPC и Magic Router.\n1. В проекте 1 создайте соединение между VPC и Magic Router.\n- Выберите сервис Magic Router.\n- Нажмите Создать Magic Router.\n- В Типе соединения выберите VPC Evolution.\n- Выберите VPC-1.\n- Нажмите Создать.\nУбедитесь, что в проекте 1 → Сеть → Magic Router на странице Соединения отображается соединение VPC-1 в статусе «Активно».\n2. В проекте 2 создайте соединение между VPC и Magic Router.\n- Выберите сервис Magic Router.\n- Нажмите Создать Magic Router.\n- В Типе соединения выберите VPC Evolution.\n- Выберите VPC-2.\n- Нажмите Создать.\nУбедитесь, что в проекте 2 → Сеть → Magic Router на странице Соединения соединение VPC-2 отображается в статусе «Активно».\n\n## 3. Создайте соединение Magic Link\n1. В проекте 2 → Сеть → Magic Router перейдите на вкладку Информация и скопируйте ID Magic Router.\n2. В проекте 1 создайте Magic Link.\n- В проекте 1 выберите Сеть → Magic Router, перейдите на вкладку Соединения.\n- Нажмите Создать cоединение.\n- В Типе соединения выберите Magic Link.\n- Название соединения: MagicLink-1.\n- В поле Magic Router ID укажите идентификатор Magic Router, который получили на шаге 1 инструкции.\n- Нажмите Добавить.\nСоединение будет создано со статусом «Ожидает подтверждения».\nДождитесь, когда в проекте 2 запрос на создание Magic Link будет одобрен.\nУбедитесь, что в обоих проектах → Сеть → Magic Router на странице Соединения соединение MagicLink-1 отображается в статусе «Активно».\n\n## 4. Настройте маршруты на Magic Router\nВнимание При создании маршрутов на Magic Router необходимо указывать зону доступности, в которой расположена целевая подсеть.\n1. В проекте 1 настройте маршруты на Magic Router:\n1. В сервисе Magic Router создайте маршрут к подсети subnet-1:\n- Адрес назначения: 10.1.1.0/24.\n- VPC: VPC-1.\n- Зона доступности: ru.AZ-1.\n2. В сервисе Magic Router создайте маршрут к подсети subnet-2:\n- Адрес назначения: 10.3.3.0/24.\n- VPC: VPC-1.\n- Зона доступности: ru.AZ-2.\n3. В сервисе Magic Router создайте маршрут к подсети subnet-3:\n- Адрес назначения: 10.2.2.0/24.\n- VPC: Magic Link.\n- Зона доступности: ru.AZ-1.\nУбедитесь, что в проекте 1 → Сеть → Magic Router на странице Маршруты три маршрута отображаются в статусе «Создан».\n2. В проекте 2 настройте маршруты на Magic Router:\n1. В сервисе Magic Router создайте маршрут к подсети subnet-1:\n- Адрес назначения: 10.1.1.0/24.\n- VPC: Magic Link.\n- Зона доступности: ru.AZ-1.\n2. В сервисе Magic Router создайте маршрут к подсети subnet-2:\n- Адрес назначения: 10.3.3.0/24.\n- VPC:  Magic Link.\n- Зона доступности: ru.AZ-2.\nПодсказка Маршруты через Magic Link лучше создавать в зоне доступности, в которой находится подсеть назначения — подсеть проекта 2.В большинстве случаев связность появится независимо от того, в какой зоне доступности создан маршрут.\nНо в таком случае возможна неоптимальная маршрутизация трафика.\n3. В сервисе Magic Router создайте маршрут к подсети subnet-3:\n- Адрес назначения: 10.2.2.0/24.\n- VPC: VPC-2.\n- Зона доступности: ru.AZ-1.\nУбедитесь, что в проекте 2 → Сеть → Magic Router на странице Маршруты три маршрута отображаются в статусе «Создан».\n\n## 5. Настройте маршруты для VPC\nВнимание При создании маршрутов в VPC необходимо указывать зону доступности, в которой расположена подсеть этой VPC.\nЕсли в VPC созданы подсети в нескольких зонах доступности, маршруты необходимо создать в каждой зоне доступности.\n1. В проекте 1 настройте маршруты для Evolution VPC:\n1. В сервисе VPC выберите VPC-1.\n2. Создайте пользовательский маршрут с параметрами:\n- Адрес назначения: 10.2.2.0/24.\n- Next Hop Type: Magic Router.\n- Зона доступности: ru.AZ-1.\n3. Создайте еще один маршрут с параметрами:\n- Адрес назначения: 10.2.2.0/24.\n- Next Hop Type: Magic Router.\n- Зона доступности: ru.AZ-2.\nУбедитесь, что в проекте 1 → Сеть → VPC на странице Маршруты для VPC-1 два маршрута отображаются в статусе «Активен».\n2. В проекте 2 настройте маршруты для Evolution VPC:\n1. В сервисе VPC выберите VPC-2.\n2. Создайте пользовательский маршрут с параметрами:\n- Адрес назначения: 10.1.1.0/24.\n- Next Hop Type: Magic Router.\n- Зона доступности: ru.AZ-1.\n3. Создайте еще один маршрут с параметрами:\n- Адрес назначения: 10.3.3.0/24.\n- Next Hop Type: Magic Router.\n- Зона доступности: ru.AZ-1.\nУбедитесь, что в проекте 2 → Сеть → VPC на странице Маршруты для VPC-2 два маршрута отображаются в статусе «Активен».\nПодсказкаВ VPC можно создать один агрегированный маршрут 10.0.0.0/8 вместо всех более специфичных маршрутов.\nЭто не повлияет на маршрутизацию трафика к локальным подсетям в данной VPC.\n\n## 6. Настройте правила групп безопасности\n1. В проекте 1 добавьте правила входящего трафика в группы безопасности SSH-access_ru.AZ-1 и SSH-access_ru.AZ-2:\n1. Выберите сервис Группы безопасности.\n2. Для группы безопасности SSH-access_ru.AZ-1 создайте правило для входящего трафика с параметрами:\n- Протокол: ICMP.\n- Тип источника: IP-адрес.\n- Источник: 0.0.0.0/0.\n3. Для группы безопасности SSH-access_ru.AZ-2 создайте правило для входящего трафика с параметрами:\n- Протокол: ICMP.\n- Тип источника: IP-адрес.\n- Источник: 0.0.0.0/0.\nУбедитесь, что в проекте 1 → Сеть → Группы безопасности в группах безопасности SSH-access_ru.AZ-1 и SSH-access_ru.AZ-2 отображается созданное правило входящего трафика.\n2. В проекте 2 добавьте правила входящего трафика в группу безопасности SSH-access_ru.AZ-1:\n1. Выберите сервис Группы безопасности.\n2. Для группы безопасности SSH-access_ru.AZ-1 создайте правило для входящего трафика с параметрами:\n- Протокол: ICMP.\n- Тип источника: IP-адрес.\n- Источник: 0.0.0.0/0.\nУбедитесь, что в проекте 2 → Сеть → Группы безопасности в группе безопасности SSH-access_ru.AZ-1 и SSH-access_ru.AZ-2 отображается созданное правило входящего трафика.\n\n## 7. Проверьте сетевую связность\n1. Подключитесь к любой виртуальной машине через виртуальную консоль.\n2. Чтобы проверить сетевую связность с оставшимися виртуальными машинами, выполните команду:\n```\nping <IP>\n```\n\nГде IP — IP-адрес виртуальной машины, с которой надо проверить сетевую связность.\n\n## Результат\nВы настроили связность между виртуальными машинами в разных VPC из разных проектов через Magic Link и получили опыт работы с соединениями, маршрутами и правилами групп безопасности.\n\n  [© 2025 Cloud.ru](https://cloud.ru)",
      "debug": {
        "start_page": 1,
        "end_page": 1
      }
    }
  ]
}