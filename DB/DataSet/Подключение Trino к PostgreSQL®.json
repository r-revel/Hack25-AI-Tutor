{
  "title": "Подключение Trino к PostgreSQL®",
  "chapters": [
    {
      "name": "Подключение Trino к PostgreSQL®",
      "content": "Практические руководства Evolution    \n\n # Подключение Trino к PostgreSQL®   Эта статья полезна?          \nС помощью этого руководства вы выполните:\n\n- подключение инстанса Managed Trino к PostgreSQL®;\n- отправку запроса через популярный JDBC-клиент DBeaver;\n- создание, заполнение таблиц и объединение данных из двух таблиц через SQL-запрос.\n\nВнимание Все сущности должны располагаться в одной VPC и подсетях одного типа.\n\n## Перед началом работы\n1. Зарегистрируйтесь в личном кабинете Cloud.ru.\nЕсли вы уже зарегистрированы, войдите под своей учетной записью.\n2. (Опционально) Cоздайте публичный SNAT-шлюз, если необходим доступ в интернет.\n3. Настройте DNS-сервер и подсеть.\n4. Создайте кластер Data Platform, в котором будет размещен инстанс.\nНазовите кластер «dp-labs».\n5. Скачайте и установите root-сертификат на устройство.\n6. Установите JDBC-клиент DBeaver.\n\n## Создайте базу данных Managed PostgreSQL®\n1. Откройте сервис Managed PostgreSQL®, в правом верхнем углу нажмите Создать кластер.\n2. Создайте две базы данных, следуя шагам, описанным в документации Managed PostgreSQL®.\nЗадайте следующие названия:\n- Названия кластеров DBaaS-PG-1 и DBaaS-PG-2.\n- Названия баз данных dbaas_pg_1 и dbaas_pg_2.\n3. Дождитесь, когда статус обоих кластеров изменится на «Доступен».\n4. Откройте карточки созданных кластеров PostgreSQL®.\nИнформация из них понадобится на следующих этапах.\n\n## Создайте каталог\n1. Откройте сервис Managed Trino.\n2. Откройте раздел Каталоги.\n3. Нажмите Создать каталог.\n4. Заполните поля следующими значениями:\n- Название — postgres_1.\n- Коннектор — PostgreSQL.\n- Хост — внутренний IP, указанный в карточке кластера DBaaS-PG-1.\n- Порт — порт, указанный в карточке кластера DBaaS-PG-1.\n- Название базы данных — dbaas_pg_1.\n- Логин — логин, указанный в карточке кластера DBaaS-PG-1.\n- Пароль — секретный ключ сервиса Secret Management.\nЕсли нужного секрета нет, создайте новый, нажав Создать новый секрет.\n5. Нажмите Создать.\n6. Создайте второй каталог и заполните поля следующими значениями:\n- Название — postgres_2.\n- Коннектор — PostgreSQL.\n- Хост — внутренний IP, указанный в карточке кластера DBaaS-PG-2.\n- Порт — порт, указанный в карточке кластера DBaaS-PG-2.\n- Название базы данных — dbaas_pg_2.\n- Логин — логин, указанный в карточке кластера DBaaS-PG-2.\n- Пароль — секретный ключ.\nЕсли нужного секрета нет, создайте новый, нажав Создать новый секрет.\n7. Нажмите Создать.\nНа странице Managed Trino на вкладке Каталоги появится две записи с названиями «postgres_1» и «postgres_2».\n\n## Создайте инстанс Managed Trino\n1. Откройте сервис Managed Trino.\n2. Откройте раздел Инстансы.\n3. Нажмите Создать инстанс.\n4. В блоке Общие параметры заполните поля:\n- Название — trino-instance-lab-1.\n- Кластер — db-labs.\n- Вычислительные ресурсы — vCPU 4, RAM 16.\n- Количество node — 3.\n5. Нажмите Продолжить.\n6. На шаге Каталоги выберите каталоги postgres_1 и postgres_2.\n7. Нажмите Продолжить.\n8. В блоке Сетевые настройки заполните поля:\n- Зона доступности — выберите зону доступности, для которой создан SNAT-шлюз.\n- Подсеть — выберите подсеть с DNS-сервером.\nВ этой подсети должен располагаться инстанс Managed Metastore.\n- Подключить публичный хост — активируйте опцию.\n- Пользователь — введите имя пользователя.\n- Пароль — выберите секретный ключ.\n9. Нажмите Создать.\n10. Дождитесь, когда статус инстанса изменится на «Готов».\n11. Откройте карточку инстанса Managed Trino.\nИнформация из него понадобится на следующих этапах.\n\n## Подключите Managed Trino к DBeaver\n\n### Добавьте сертификат в Java KeyStore\n1. Запустите терминал и перейдите в директорию, где хотите сохранить JKS-файл.\n2. Введите команду:\n```\nkeytool -importcert  -alias cloudru-root  -file <PATH>/dp-cert.crt  -keystore <PATH>/cloudru-truststore.jks  -storetype JKS  -storepass <YOUR-PASSWORD>  -noprompt\n```\n\n- В строке -file вместо <PATH> укажите путь до скачанного ранее root-сертификата.\n- В строке -keystore вместо <PATH> укажите путь до места, где будет храниться JKS-файл.\nСохраните путь.\nОн понадобится при добавлении JKS-файла в DBeaver.\n- В строке -storepass вместо <YOUR-PASSWORD> задайте пароль для сертификата.\nСохраните пароль.\nОн понадобится при добавлении JKS-файла в DBeaver.\n\n### Подключите DBeaver\n1. Откройте приложение DBeaver.\n2. В панели сверху нажмите База данных → Новое соединение.\n3. В списке соединений выберите Trino.\n4. Нажмите Далее заполните поля на вкладке Главное:\n- Хост — публичный хост, указанный в карточке инстанса.\n- Порт — порт, указанный в карточке инстанса.\n- Пользователь — пользователь, указанный в карточке инстанса.\n- Пароль — пароль, указанный в карточке инстанса.\n5. На вкладке Свойства драйвера измените значение свойства SSL на true.\n6. Нажмите Тест соединения.\n7. Нажмите Готово.\nСлева в списке объектов появится две базы данных PostgreSQL® с названиями «postgres_1» и «postgres_2».\n\n## Отправьте SQL-запрос\n1. Создайте схемы.\n- Для первой БД dbaas_pg_1:\n```\nCREATE SCHEMA IF NOT EXISTS postgres_1.lab\n```\n- Для второй БД dbaas_pg_2:\n```\nCREATE SCHEMA IF NOT EXISTS postgres_2.lab\n```\n2. Создайте таблицы в базах данных.\n- Для первой БД dbaas_pg_1:\n```\nCREATE TABLE IF NOT EXISTS postgres_1.lab.brand (id INT, name VARCHAR(255))\n```\n- Для второй БД dbaas_pg_2:\n```\nCREATE TABLE IF NOT EXISTS postgres_2.lab.car (id INT, name VARCHAR(255), brand_id INT)\n```\n3. Заполните таблицы.\n- Для первой БД dbaas_pg_1:\n```\nINSERT INTO postgres_1.lab.brand values (1, 'Mazda'), (2, 'BMW'), (3, 'Kia')\n```\n- Для второй БД dbaas_pg_2:\n```\nINSERT INTO postgres_2.lab.car values (1, 'CX-5', 1), (2, 'CX-9', 1), (3, 'Rio', 3), (4, 'X3', 2), (5, 'X5', 2)\n```\n4. Объедините таблицу с брендами в первой БД dbaas_pg_1 с названиями авто во второй БД dbaas_pg_2.\n```\nselect c.name as car, b.name as brandfrom postgres_2.lab.car cleft join postgres_1.lab.brand bon c.brand_id = b.id\n```\n\n  [© 2025 Cloud.ru](https://cloud.ru)",
      "debug": {
        "start_page": 1,
        "end_page": 1
      }
    }
  ]
}